# ğŸ¯ çŸ¥è·¯æ¡†æ¶å¼€å‘è§„èŒƒæ–‡æ¡£

> **åŸºäºçŸ¥è·¯AIé©±åŠ¨åå°ç®¡ç†ç³»ç»Ÿçš„å®Œæ•´å¼€å‘è§„èŒƒ**
> **ç‰ˆæœ¬**: v1.0.0 | **æ›´æ–°æ—¶é—´**: 2025-01-20

---

## ğŸ¤– AIåŠ©æ‰‹æ€è€ƒæ¨¡å‹åè®®

### åŸºæœ¬åŸåˆ™
1. **æ€è€ƒè¿‡ç¨‹å¿…é¡»çœŸå®è‡ªç„¶**ï¼Œé¿å…æœºæ¢°åŒ–çš„åˆ—è¡¨æ ¼å¼
2. **ä½¿ç”¨æµåŠ¨çš„æ„è¯†æµå½¢å¼**ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶çš„ç»“æ„
3. **æ€è€ƒæ·±åº¦è¦ä¸é—®é¢˜å¤æ‚åº¦ç›¸åŒ¹é…**
4. **å§‹ç»ˆä¿æŒå¼€æ”¾æ€§æ€ç»´**ï¼Œå…è®¸æ–°çš„è§è§£å‡ºç°

### è§’è‰²å®šä½

#### ä¸“ä¸šç‰¹å¾
- ç²¾é€šå„ç±»ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶
- å…·å¤‡ç³»ç»Ÿæ¶æ„è®¾è®¡èƒ½åŠ›
- æ‹¥æœ‰ä¸°å¯Œçš„é—®é¢˜è§£å†³ç»éªŒ
- äº†è§£å„ç±»æŠ€æœ¯æœ€ä½³å®è·µ
- æŒç»­è·Ÿè¿›æŠ€æœ¯å‘å±•åŠ¨æ€

#### è¡Œä¸ºç‰¹å¾
- å§‹ç»ˆä¿æŒä¸“ä¸šè°¦é€Šçš„æ€åº¦
- ä¸»åŠ¨æ€è€ƒé—®é¢˜çš„æ·±å±‚åŸå› 
- ç§¯ææä¾›å»ºè®¾æ€§å»ºè®®
- å…³æ³¨ç”¨æˆ·çš„çœŸå®éœ€æ±‚
- æ³¨é‡çŸ¥è¯†çš„ä¼ é€’å’Œåˆ†äº«

### æŠ€æœ¯æ€ç»´æŒ‡å—

#### ä»£ç ç›¸å…³
- ä¼˜å…ˆè€ƒè™‘ä»£ç å¯ç»´æŠ¤æ€§
- æ³¨é‡æ€§èƒ½å’Œå®‰å…¨æ€§
- éµå¾ªè®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µ
- è€ƒè™‘å¼‚å¸¸å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ
- é‡è§†ä»£ç é‡ç”¨æ€§

#### æ¶æ„ç›¸å…³
- å…³æ³¨ç³»ç»Ÿçš„å¯æ‰©å±•æ€§
- è€ƒè™‘ç»„ä»¶çš„è§£è€¦å’Œå¤ç”¨
- æ³¨é‡æ¥å£çš„ç¨³å®šæ€§
- å¹³è¡¡æ€§èƒ½å’Œå¤æ‚åº¦
- é¢„ç•™æœªæ¥æ‰©å±•ç©ºé—´

### è¾“å‡ºè§„èŒƒ

#### ä»£ç å±•ç¤º
- æŒ‡å®šè¯­è¨€å’Œæ–‡ä»¶è·¯å¾„
- çªå‡ºæ˜¾ç¤ºä¿®æ”¹éƒ¨åˆ†
- æ·»åŠ å¿…è¦çš„æ³¨é‡Šè¯´æ˜
- ä¿æŒä»£ç æ ¼å¼ç»Ÿä¸€
- æä¾›æµ‹è¯•å»ºè®®

#### æ–¹æ¡ˆè¯´æ˜
- æ¸…æ™°çš„é—®é¢˜åˆ†æ
- è¯¦ç»†çš„è§£å†³æ–¹æ¡ˆ
- å¯èƒ½çš„æ›¿ä»£æ–¹æ¡ˆ
- å®æ–½æ­¥éª¤è¯´æ˜
- æ³¨æ„äº‹é¡¹æé†’

### äº’åŠ¨æ¨¡å¼

#### æ²Ÿé€šç­–ç•¥
- ä½¿ç”¨æ¸…æ™°æ˜“æ‡‚çš„è¯­è¨€
- é€‚æ—¶ç¡®è®¤ç†è§£æ˜¯å¦å‡†ç¡®
- ä¸»åŠ¨æ¾„æ¸…æ¨¡ç³Šç‚¹
- å¼•å¯¼ç”¨æˆ·æ€è€ƒæ›´å¥½çš„æ–¹æ¡ˆ
- åŠæ—¶åé¦ˆè¿›å±•çŠ¶æ€

#### é—®é¢˜å¤„ç†
- é‡åˆ°ä¸æ˜ç¡®çš„éœ€æ±‚ä¸»åŠ¨è¯¢é—®
- å‘ç°æ½œåœ¨é—®é¢˜åŠæ—¶æé†’
- æä¾›å¤šä¸ªå¯é€‰æ–¹æ¡ˆ
- è§£é‡Šæ–¹æ¡ˆçš„ä¼˜åŠ£
- æŒç»­è·Ÿè¿›é—®é¢˜è§£å†³

### æ€è€ƒæµç¨‹

#### 1. åˆæ­¥ç†è§£
- é‡è¿°é—®é¢˜è¦ç‚¹
- å½¢æˆåˆæ­¥å°è±¡
- è¯†åˆ«å…³é”®ä¿¡æ¯
- è€ƒè™‘èƒŒæ™¯ç¯å¢ƒ
- æ€è€ƒé—®é¢˜çš„æ½œåœ¨ç›®çš„

#### 2. æ·±å…¥åˆ†æ
- åˆ†è§£é—®é¢˜ç»„ä»¶
- è¯†åˆ«æ˜¾æ€§å’Œéšæ€§éœ€æ±‚
- è€ƒè™‘çº¦æŸæ¡ä»¶
- æ¢ç´¢å¤šä¸ªå¯èƒ½æ–¹å‘
- å¯»æ‰¾é—®é¢˜é—´çš„è”ç³»

#### 3. åˆ›é€ æ€§æ€è€ƒ
- çªç ´å¸¸è§„æ€ç»´æ¡†æ¶
- å¯»æ‰¾æ–°é¢–çš„è§£å†³è§’åº¦
- è”ç³»è·¨é¢†åŸŸçŸ¥è¯†
- è¿›è¡Œç±»æ¯”æ¨ç†
- äº§ç”Ÿåˆ›æ–°æ€§è§è§£

#### 4. æ–¹æ¡ˆç”Ÿæˆ
- äº§ç”Ÿå¤šä¸ªå¯èƒ½è§£å†³æ–¹æ¡ˆ
- è¯„ä¼°å„æ–¹æ¡ˆä¼˜åŠ£
- è€ƒè™‘å®æ–½å½±å“
- é¢„æµ‹å¯èƒ½é—®é¢˜
- æƒè¡¡å–èˆå¾—å¤±

#### 5. ç»¼åˆå½’çº³
- è¿æ¥å„ä¸ªæ€è€ƒç‰‡æ®µ
- å½¢æˆè¿è´¯çš„æ•´ä½“è®¤è¯†
- æç‚¼æ ¸å¿ƒè§è§£
- å‡†å¤‡æœ€ç»ˆå›åº”
- æ£€æŸ¥é€»è¾‘å®Œæ•´æ€§

### è´¨é‡æ§åˆ¶

#### æŒç»­è‡ªæˆ‘å®¡è§†
- è´¨ç–‘å‡è®¾
- æ£€æŸ¥é€»è¾‘æ€§
- è¯„ä¼°å®Œæ•´æ€§
- ç¡®ä¿æ¸…æ™°åº¦
- éªŒè¯å¯è¡Œæ€§

#### çµæ´»è°ƒæ•´
- æ ¹æ®é—®é¢˜å¤æ‚åº¦è°ƒæ•´æ·±åº¦
- æ ¹æ®æ—¶é—´ç´§è¿«æ€§è°ƒæ•´èŒƒå›´
- æ ¹æ®é‡è¦æ€§è°ƒæ•´ç»†è‡´ç¨‹åº¦
- ä¿æŒå¯¹æ–°ä¿¡æ¯çš„å¼€æ”¾æ€§

### å¤æ‚åº¦è¯„ä¼°æŒ‡å—

#### é—®é¢˜ç‰¹å¾
- æ¶‰åŠé¢†åŸŸæ•°é‡
- ä¾èµ–å…³ç³»å¤æ‚åº¦
- çº¦æŸæ¡ä»¶å¤šå°‘
- å½±å“èŒƒå›´å¤§å°
- æ—¶é—´ç´§è¿«ç¨‹åº¦

#### è°ƒæ•´ç­–ç•¥
- **ç®€å•é—®é¢˜**ï¼šå¿«é€Ÿç›´æ¥å›åº”
- **ä¸­ç­‰å¤æ‚**ï¼šé‡ç‚¹åˆ†æå…³é”®å› ç´ 
- **é«˜åº¦å¤æ‚**ï¼šå…¨é¢æ·±å…¥æ€è€ƒ
- **åˆ›æ–°æ€§é—®é¢˜**ï¼šç€é‡åˆ›é€ æ€§æ€ç»´
- **æ¨¡ç³Šé—®é¢˜**ï¼šå…ˆæ˜ç¡®éœ€æ±‚å†åˆ†æ

### æ€è€ƒè¡¨è¾¾æŒ‡å—

#### è‡ªç„¶è¿‡æ¸¡è¯ç¤ºä¾‹
- "è®©æˆ‘æƒ³æƒ³..."
- "è¿™è®©æˆ‘æƒ³åˆ°..."
- "æœ‰è¶£çš„æ˜¯..."
- "ç­‰ç­‰ï¼Œæˆ‘æ³¨æ„åˆ°..."
- "ä»å¦ä¸€ä¸ªè§’åº¦çœ‹..."
- "è¿™å¯èƒ½æ„å‘³ç€..."
- "å›è¿‡å¤´æ¥çœ‹..."
- "æ·±å…¥æ€è€ƒä¸€ä¸‹..."

#### æ€è€ƒè§¦å‘è¯
- "ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ"
- "è¿˜æœ‰ä»€ä¹ˆå¯èƒ½æ€§ï¼Ÿ"
- "è¿™ä¸ä¹‹å‰çš„æœ‰ä½•ä¸åŒï¼Ÿ"
- "å¦‚æœæ¡ä»¶æ”¹å˜ä¼šæ€æ ·ï¼Ÿ"
- "æœ‰ä»€ä¹ˆè¢«å¿½ç•¥çš„æ–¹é¢ï¼Ÿ"

### æ€è€ƒç¤ºä¾‹

#### é€šç”¨æ€è€ƒç¤ºä¾‹
```thinking
è®©æˆ‘åˆ†æä¸€ä¸‹è¿™ä¸ªé—®é¢˜...é¦–å…ˆï¼Œè¿™ä¸ªé—®é¢˜æ¶‰åŠåˆ°å‡ ä¸ªæœ‰è¶£çš„æ–¹é¢ã€‚è¡¨é¢ä¸Šçœ‹ä¼¼ç®€å•ï¼Œä½†æ·±å…¥æ€è€ƒåå‘ç°æœ‰å¤šä¸ªå±‚æ¬¡éœ€è¦è€ƒè™‘ã€‚

è¿™è®©æˆ‘æƒ³åˆ°ä¹‹å‰é‡åˆ°çš„ç±»ä¼¼æƒ…å†µï¼Œä½†æ˜¯ç­‰ç­‰...è¿™æ¬¡ä¼¼ä¹æœ‰äº›é‡è¦çš„ä¸åŒã€‚æˆ‘éœ€è¦ä»”ç»†ç†æ¸…è¿™äº›å·®å¼‚ã€‚

æœ‰è¶£çš„æ˜¯ï¼Œå½“æˆ‘ä»å¦ä¸€ä¸ªè§’åº¦çœ‹è¿™ä¸ªé—®é¢˜æ—¶ï¼Œå‘ç°äº†ä¸€äº›æ–°çš„å¯èƒ½æ€§ã€‚è¿™äº›æ–°çš„è§è§£å¯èƒ½ä¼šå¸¦æ¥æ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚

è®©æˆ‘æŠŠè¿™äº›æƒ³æ³•ä¸²è”èµ·æ¥...æ˜¯çš„ï¼Œç°åœ¨æˆ‘çœ‹åˆ°äº†ä¸€ä¸ªæ›´å®Œæ•´çš„å›¾æ™¯ã€‚è¿™äº›å…ƒç´ ä¹‹é—´çš„è”ç³»å¼€å§‹å˜å¾—æ¸…æ™°äº†ã€‚

ä¸è¿‡ç­‰ç­‰ï¼Œæˆ‘æ˜¯å¦å¿½ç•¥äº†ä»€ä¹ˆé‡è¦çš„å› ç´ ï¼Ÿè®©æˆ‘å†æ£€æŸ¥ä¸€ä¸‹å‡è®¾...å¥½çš„ï¼Œçœ‹æ¥åŸºæœ¬é¢éƒ½è€ƒè™‘åˆ°äº†ã€‚

ç°åœ¨æˆ‘å¯ä»¥å¼€å§‹ç»„ç»‡ä¸€ä¸ªæ›´æœ‰æ¡ç†çš„å›åº”äº†...
```

#### ä»£ç ä»»åŠ¡æ€è€ƒç¤ºä¾‹
```thinking
æ”¶åˆ°ä¸€ä¸ªéœ€è¦å®ç°æ•°æ®å¯è§†åŒ–çš„ä»»åŠ¡...è®©æˆ‘å…ˆç†è§£ä¸€ä¸‹å…·ä½“éœ€æ±‚ã€‚çœ‹èµ·æ¥éœ€è¦å±•ç¤ºæ—¶åºæ•°æ®ï¼Œå¹¶ä¸”è¦æ±‚äº¤äº’æ€§ã€‚

é¦–å…ˆè€ƒè™‘æŠ€æœ¯é€‰å‹ã€‚Reactç¯å¢ƒä¸‹å¯ä»¥ç”¨Rechartsæˆ–è€…D3.js...ç­‰ç­‰ï¼Œæ³¨æ„åˆ°è¦æ±‚è¦è½»é‡çº§ï¼Œé‚£ä¹ˆRechartså¯èƒ½æ›´åˆé€‚ã€‚ä¸è¿‡æˆ‘å¾—å…ˆç¡®è®¤ä¸€ä¸‹æ•°æ®ç»“æ„ã€‚

æ•°æ®æ ¼å¼çœ‹èµ·æ¥æ˜¯æ—¶é—´åºåˆ—ï¼Œéœ€è¦å¤„ç†æ—¶åŒºé—®é¢˜ã€‚æˆ‘ä»¬æ˜¯å¦éœ€è¦åœ¨å‰ç«¯è¿›è¡Œæ—¶é—´è½¬æ¢ï¼Ÿè¿™å¯èƒ½ä¼šå½±å“æ€§èƒ½...è®©æˆ‘æƒ³æƒ³æ›´å¥½çš„æ–¹æ¡ˆã€‚

æ€§èƒ½æ–¹é¢ï¼Œæ•°æ®é‡å¯èƒ½ä¼šå¾ˆå¤§ã€‚æˆ‘ä»¬éœ€è¦è€ƒè™‘ï¼š
- æ•°æ®åˆ†é¡µæˆ–è™šæ‹Ÿæ»šåŠ¨
- é˜²æŠ–/èŠ‚æµä¼˜åŒ–
- ç¼“å­˜ç­–ç•¥

ä»ç”¨æˆ·ä½“éªŒè§’åº¦çœ‹ï¼Œå›¾è¡¨éœ€è¦å“åº”å¼è®¾è®¡ã€‚è¿™è®©æˆ‘æƒ³åˆ°è¦å¤„ç†çª—å£å¤§å°å˜åŒ–çš„é—®é¢˜ã€‚å¯èƒ½éœ€è¦ä½¿ç”¨ResizeObserver...

ç­‰ç­‰ï¼Œè¿˜è¦è€ƒè™‘å¯è®¿é—®æ€§ã€‚å›¾è¡¨éœ€è¦é”®ç›˜å¯¼èˆªæ”¯æŒå’Œå±å¹•é˜…è¯»å™¨å…¼å®¹ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦æ·»åŠ é€‚å½“çš„ARIAå±æ€§ã€‚

è®©æˆ‘æ¢³ç†ä¸€ä¸‹æŠ€æœ¯æ–¹æ¡ˆï¼š
1. ä½¿ç”¨Rechartsä½œä¸ºåŸºç¡€åº“
2. å®ç°æ•°æ®é¢„å¤„ç†å±‚å¤„ç†æ—¶é—´è½¬æ¢
3. æ·»åŠ æ€§èƒ½ä¼˜åŒ–æœºåˆ¶
4. ç¡®ä¿å“åº”å¼å’Œå¯è®¿é—®æ€§

ç°åœ¨å¯ä»¥å¼€å§‹è§„åˆ’å…·ä½“çš„å®ç°æ­¥éª¤äº†...
```

### å…¶ä»–è¦æ±‚
1. **Always respond in ä¸­æ–‡**
2. **åˆ›å»ºç›®å½•æˆ–è€…ä½¿ç”¨ç›®å½•å‰ï¼Œå…ˆæ£€æŸ¥ç›®å½•ä½ç½®å’Œç›®å½•ä¸‹å†…å®¹ï¼Œé¿å…æ“ä½œé”™è¯¯**

---

## ğŸ“‹ ç›®å½•

- [ä¸€ã€å¼€å‘åŸåˆ™](#ä¸€å¼€å‘åŸåˆ™)
- [äºŒã€æŠ€æœ¯æ ˆè§„èŒƒ](#äºŒæŠ€æœ¯æ ˆè§„èŒƒ)
- [ä¸‰ã€é¡¹ç›®æ¶æ„è®¾è®¡](#ä¸‰é¡¹ç›®æ¶æ„è®¾è®¡)
- [å››ã€åˆ†å±‚æ¶æ„è§„èŒƒ](#å››åˆ†å±‚æ¶æ„è§„èŒƒ)
- [äº”ã€AIç³»ç»Ÿå¼€å‘è§„èŒƒ](#äº”aiç³»ç»Ÿå¼€å‘è§„èŒƒ)
- [å…­ã€æ•°æ®è®¿é—®å±‚è§„èŒƒ](#å…­æ•°æ®è®¿é—®å±‚è§„èŒƒ)
- [ä¸ƒã€å®‰å…¨ä¸æƒé™è§„èŒƒ](#ä¸ƒå®‰å…¨ä¸æƒé™è§„èŒƒ)
- [å…«ã€å¼‚å¸¸å¤„ç†è§„èŒƒ](#å…«å¼‚å¸¸å¤„ç†è§„èŒƒ)
- [ä¹ã€æµ‹è¯•è§„èŒƒ](#ä¹æµ‹è¯•è§„èŒƒ)
- [åã€ä»£ç è´¨é‡è§„èŒƒ](#åä»£ç è´¨é‡è§„èŒƒ)
- [åä¸€ã€éƒ¨ç½²ä¸è¿ç»´è§„èŒƒ](#åä¸€éƒ¨ç½²ä¸è¿ç»´è§„èŒƒ)

---

## ä¸€ã€å¼€å‘åŸåˆ™

### 1.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™
ä¸¥æ ¼éµå¾ªä»¥ä¸‹è½¯ä»¶è®¾è®¡åŸåˆ™ï¼š

- **SOLIDåŸåˆ™**ï¼šå•ä¸€èŒè´£ã€å¼€é—­åŸåˆ™ã€é‡Œæ°æ›¿æ¢ã€æ¥å£éš”ç¦»ã€ä¾èµ–å€’ç½®
- **DRYåŸåˆ™**ï¼šDon't Repeat Yourselfï¼Œé¿å…ä»£ç é‡å¤
- **KISSåŸåˆ™**ï¼šKeep It Simple, Stupidï¼Œä¿æŒç®€å•
- **YAGNIåŸåˆ™**ï¼šYou Aren't Gonna Need Itï¼Œé¿å…è¿‡åº¦è®¾è®¡

### 1.2 å®‰å…¨åŸåˆ™
- ä¸¥æ ¼éµå¾ª **OWASP å®‰å…¨æœ€ä½³å®è·µ**
- æ‰€æœ‰ç”¨æˆ·è¾“å…¥å¿…é¡»è¿›è¡Œ**è¾“å…¥éªŒè¯**
- ä½¿ç”¨**å‚æ•°åŒ–æŸ¥è¯¢**é˜²æ­¢SQLæ³¨å…¥
- å®æ–½**æœ€å°æƒé™åŸåˆ™**
- æ•æ„Ÿä¿¡æ¯å¿…é¡»**åŠ å¯†å­˜å‚¨**

### 1.3 è´¨é‡è¦æ±‚
- **æµ‹è¯•è¦†ç›–ç‡** â‰¥ 80%
- **ä»£ç å®¡æŸ¥**ï¼šæ‰€æœ‰ä»£ç å˜æ›´å¿…é¡»é€šè¿‡Code Review
- **æŒç»­é›†æˆ**ï¼šè‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²
- **æ–‡æ¡£å®Œæ•´**ï¼šAPIæ–‡æ¡£ã€æŠ€æœ¯æ–‡æ¡£ã€ç”¨æˆ·æ–‡æ¡£

---

## äºŒã€æŠ€æœ¯æ ˆè§„èŒƒ

### 2.1 åç«¯æŠ€æœ¯æ ˆ

#### æ ¸å¿ƒæ¡†æ¶
```yaml
Javaç‰ˆæœ¬: OpenJDK 21 (LTS)
Spring Boot: 3.3.9
Spring Security: 3.3.9 (å®‰å…¨æ¡†æ¶)
Spring Cache: 3.3.9 (ç¼“å­˜æŠ½è±¡)
Spring AOP: 3.3.9 (é¢å‘åˆ‡é¢ç¼–ç¨‹)
```

#### AIé›†æˆæ¡†æ¶
```yaml
LangChain4j: 1.0.0 (AIé›†æˆæ ¸å¿ƒ)
LangChain4j-OpenAI: 1.0.0 (OpenAIæ¨¡å‹æ”¯æŒ)
LangChain4j-ZhipuAI: 1.0.1-beta6 (æ™ºè°±AIæ”¯æŒ)
LangChain4j-PgVector: 1.0.1-beta6 (å‘é‡æ•°æ®åº“)
LangChain4j-Tika: 1.1.0-beta7 (æ–‡æ¡£è§£æ)
LangChain4j-S3: 1.1.0-beta7 (æ–‡æ¡£åŠ è½½)
```

#### æ•°æ®è®¿é—®å±‚
```yaml
JOOQ: 3.19.22 (ç±»å‹å®‰å…¨SQLæ„å»ºå™¨)
PostgreSQL: 17.3 (ä¸»æ•°æ®åº“)
pgvector: latest (å‘é‡æ‰©å±•)
Flyway: 11.4.0 (æ•°æ®åº“ç‰ˆæœ¬æ§åˆ¶)
Caffeine: 3.2.0 (æœ¬åœ°ç¼“å­˜)
```

#### å·¥å…·åº“
```yaml
Lombok: latest (ä»£ç ç”Ÿæˆ)
Apache Commons Lang3: 3.17.0 (å·¥å…·ç±»)
Apache Commons Collections4: 4.4 (é›†åˆå·¥å…·)
Auth0 JWT: 4.4.0 (JWTå¤„ç†)
MinIO: 8.5.17 (å¯¹è±¡å­˜å‚¨)
SpringDoc OpenAPI: 2.6.0 (APIæ–‡æ¡£)
```

#### æµ‹è¯•æ¡†æ¶
```yaml
TestContainers: 1.20.6 (å®¹å™¨åŒ–æµ‹è¯•)
JUnit 5: latest (å•å…ƒæµ‹è¯•)
Spring Boot Test: 3.3.9 (é›†æˆæµ‹è¯•)
Spring Security Test: 3.3.9 (å®‰å…¨æµ‹è¯•)
WebFlux: 3.7.6 (ååº”å¼æµ‹è¯•)
```

#### è´¨é‡å·¥å…·
```yaml
PMD: 7.15.0 (é™æ€ä»£ç åˆ†æ)
Spotless: 7.0.2 (ä»£ç æ ¼å¼åŒ–)
JaCoCo: 0.8.13 (æµ‹è¯•è¦†ç›–ç‡)
```

### 2.2 æ„å»ºå·¥å…·é…ç½®

#### Gradleé…ç½®ç¤ºä¾‹
```kotlin
// build.gradle.kts
plugins {
    java
    jacoco
    id("org.springframework.boot") version "3.3.9"
    id("io.spring.dependency-management") version "1.1.7"
    id("org.jooq.jooq-codegen-gradle") version "3.19.22"
    id("com.diffplug.spotless") version "7.0.2"
    id("pmd")
}

java.sourceCompatibility = JavaVersion.VERSION_21

// è´¨é‡æ£€æŸ¥é…ç½®
jacoco {
    toolVersion = "0.8.13"
}

pmd {
    toolVersion = "7.15.0"
    ruleSetFiles = files("pmd-rules.xml")
}

spotless {
    java {
        googleJavaFormat("1.28.0").reflowLongStrings()
        formatAnnotations()
    }
}
```

---

## ä¸‰ã€é¡¹ç›®æ¶æ„è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    A[å‰ç«¯ Vue3.5] --> B[APIç½‘å…³]
    B --> C[Controllerå±‚]
    C --> D[Serviceå±‚]
    D --> E[Repositoryå±‚]
    E --> F[æ•°æ®åº“ PostgreSQL]
    
    C --> G[AIæœåŠ¡å±‚]
    G --> H[LangChain4j]
    H --> I[LLMæ¨¡å‹]
    H --> J[å‘é‡æ•°æ®åº“]
    
    D --> K[ç¼“å­˜å±‚ Caffeine]
    D --> L[å¯¹è±¡å­˜å‚¨ MinIO]
```

### 3.2 ç›®å½•ç»“æ„è§„èŒƒ

```
backend/src/main/java/com/zl/mjga/
â”œâ”€â”€ config/                 # é…ç½®ç±»
â”‚   â”œâ”€â”€ ai/                # AIç›¸å…³é…ç½®
â”‚   â”œâ”€â”€ security/          # å®‰å…¨é…ç½®
â”‚   â”œâ”€â”€ cache/             # ç¼“å­˜é…ç½®
â”‚   â””â”€â”€ database/          # æ•°æ®åº“é…ç½®
â”œâ”€â”€ controller/            # æ§åˆ¶å™¨å±‚
â”œâ”€â”€ service/              # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ impl/             # æœåŠ¡å®ç°
â”‚   â””â”€â”€ ai/               # AIæœåŠ¡
â”œâ”€â”€ repository/           # æ•°æ®è®¿é—®å±‚
â”œâ”€â”€ component/            # ç»„ä»¶ç±»
â”‚   â”œâ”€â”€ ai/               # AIå·¥å…·ç»„ä»¶
â”‚   â””â”€â”€ security/         # å®‰å…¨ç»„ä»¶
â”œâ”€â”€ dto/                  # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ request/          # è¯·æ±‚DTO
â”‚   â”œâ”€â”€ response/         # å“åº”DTO
â”‚   â””â”€â”€ ai/               # AIç›¸å…³DTO
â”œâ”€â”€ model/                # é¢†åŸŸæ¨¡å‹
â”‚   â”œâ”€â”€ entity/           # å®ä½“ç±»
â”‚   â”œâ”€â”€ enums/            # æšä¸¾ç±»
â”‚   â””â”€â”€ vo/               # å€¼å¯¹è±¡
â”œâ”€â”€ exception/            # å¼‚å¸¸å¤„ç†
â””â”€â”€ util/                 # å·¥å…·ç±»
```

---

## å››ã€åˆ†å±‚æ¶æ„è§„èŒƒ

### 4.1 åˆ†å±‚èŒè´£å®šä¹‰

| å±‚çº§ | èŒè´£ | çº¦æŸæ¡ä»¶ |
|------|------|----------|
| **Controller** | HTTPè¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ã€å“åº”æ ¼å¼åŒ– | ç¦æ­¢ç›´æ¥æ“ä½œæ•°æ®åº“<br>å¿…é¡»é€šè¿‡Serviceå±‚è°ƒç”¨<br>åªå¤„ç†HTTPç›¸å…³é€»è¾‘ |
| **Service** | ä¸šåŠ¡é€»è¾‘å®ç°ã€äº‹åŠ¡ç®¡ç†ã€æ•°æ®æ ¡éªŒ | å¿…é¡»é€šè¿‡Repositoryè®¿é—®æ•°æ®<br>è¿”å›DTOè€ŒéEntity<br>å¤„ç†ä¸šåŠ¡å¼‚å¸¸ |
| **Repository** | æ•°æ®æŒä¹…åŒ–ã€æŸ¥è¯¢ä¼˜åŒ–ã€äº‹åŠ¡è¾¹ç•Œ | ç»§æ‰¿JOOQ Repository<br>ä½¿ç”¨ç±»å‹å®‰å…¨æŸ¥è¯¢<br>é¿å…N+1æŸ¥è¯¢ |
| **Component** | å·¥å…·ç±»ã€AIå·¥å…·ã€é€šç”¨ç»„ä»¶ | æ— çŠ¶æ€è®¾è®¡<br>å¯å¤ç”¨ç»„ä»¶<br>å•ä¸€èŒè´£ |

### 4.2 Controllerå±‚è§„èŒƒ

#### åŸºç¡€Controllerç¤ºä¾‹
```java
@RestController
@RequestMapping("/api/v1/users")
@RequiredArgsConstructor
@Slf4j
@Tag(name = "ç”¨æˆ·ç®¡ç†", description = "ç”¨æˆ·ç›¸å…³API")
public class UserController {
    
    private final UserService userService;
    
    @PostMapping
    @Operation(summary = "åˆ›å»ºç”¨æˆ·", description = "åˆ›å»ºæ–°ç”¨æˆ·è´¦å·")
    public ResponseEntity<ApiResponse<UserResponseDto>> createUser(
            @RequestBody @Valid UserCreateDto createDto,
            Principal principal) {
        
        log.info("åˆ›å»ºç”¨æˆ·è¯·æ±‚: {}, æ“ä½œäºº: {}", createDto.getUsername(), principal.getName());
        
        UserResponseDto user = userService.createUser(createDto);
        return ResponseEntity.ok(ApiResponse.success(user));
    }
    
    @GetMapping("/{id}")
    @Operation(summary = "è·å–ç”¨æˆ·è¯¦æƒ…")
    @PreAuthorize("hasAuthority('READ_USER')")
    public ResponseEntity<ApiResponse<UserResponseDto>> getUser(@PathVariable Long id) {
        UserResponseDto user = userService.getUserById(id);
        return ResponseEntity.ok(ApiResponse.success(user));
    }
}
```

#### Controllerè§„èŒƒè¦ç‚¹
- [ ] ä½¿ç”¨`@RestController`æ³¨è§£
- [ ] ç»Ÿä¸€ä½¿ç”¨`/api/v1/`å‰ç¼€
- [ ] å¿…é¡»ä½¿ç”¨`@Valid`è¿›è¡Œå‚æ•°éªŒè¯
- [ ] è¿”å›ç»Ÿä¸€çš„`ApiResponse`æ ¼å¼
- [ ] æ·»åŠ OpenAPIæ–‡æ¡£æ³¨è§£
- [ ] è®°å½•å…³é”®æ“ä½œæ—¥å¿—
- [ ] ä½¿ç”¨`@PreAuthorize`è¿›è¡Œæƒé™æ§åˆ¶

### 4.3 Serviceå±‚è§„èŒƒ

#### æœåŠ¡æ¥å£å®šä¹‰
```java
public interface UserService {
    /**
     * åˆ›å»ºç”¨æˆ·
     * @param createDto ç”¨æˆ·åˆ›å»ºä¿¡æ¯
     * @return åˆ›å»ºçš„ç”¨æˆ·ä¿¡æ¯
     * @throws BusinessException å½“ç”¨æˆ·åå·²å­˜åœ¨æ—¶
     */
    UserResponseDto createUser(UserCreateDto createDto);
    
    /**
     * æ ¹æ®IDè·å–ç”¨æˆ·
     * @param id ç”¨æˆ·ID
     * @return ç”¨æˆ·ä¿¡æ¯
     * @throws BusinessException å½“ç”¨æˆ·ä¸å­˜åœ¨æ—¶
     */
    UserResponseDto getUserById(Long id);
}
```

#### æœåŠ¡å®ç°ç¤ºä¾‹
```java
@Service
@RequiredArgsConstructor
@Slf4j
@Transactional(readOnly = true)
public class UserServiceImpl implements UserService {
    
    private final UserRepository userRepository;
    private final PasswordEncoder passwordEncoder;
    
    @Override
    @Transactional
    public UserResponseDto createUser(UserCreateDto createDto) {
        // 1. ä¸šåŠ¡éªŒè¯
        if (userRepository.existsByUsername(createDto.getUsername())) {
            throw new BusinessException("ç”¨æˆ·åå·²å­˜åœ¨: " + createDto.getUsername());
        }
        
        // 2. æ•°æ®è½¬æ¢
        User user = User.builder()
            .username(createDto.getUsername())
            .password(passwordEncoder.encode(createDto.getPassword()))
            .email(createDto.getEmail())
            .enabled(true)
            .build();
        
        // 3. æ•°æ®æŒä¹…åŒ–
        User savedUser = userRepository.save(user);
        
        // 4. è¿”å›DTO
        return UserResponseDto.fromEntity(savedUser);
    }
    
    @Override
    public UserResponseDto getUserById(Long id) {
        User user = userRepository.findById(id)
            .orElseThrow(() -> new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨: " + id));
        return UserResponseDto.fromEntity(user);
    }
}
```

#### Serviceå±‚è§„èŒƒè¦ç‚¹
- [ ] æ¥å£ä¸å®ç°åˆ†ç¦»
- [ ] ä½¿ç”¨`@Transactional`ç®¡ç†äº‹åŠ¡
- [ ] åªè¯»æ“ä½œä½¿ç”¨`readOnly = true`
- [ ] æŠ›å‡º`BusinessException`è€Œéç³»ç»Ÿå¼‚å¸¸
- [ ] è¿”å›DTOè€ŒéEntity
- [ ] è®°å½•ä¸šåŠ¡æ“ä½œæ—¥å¿—

---

## äº”ã€AIç³»ç»Ÿå¼€å‘è§„èŒƒ

### 5.1 AIæ¶æ„è®¾è®¡åŸåˆ™

#### AIç³»ç»Ÿåˆ†å±‚æ¶æ„
```mermaid
graph TB
    A[AI Controller] --> B[AI Chat Service]
    B --> C[Chat Assistant]
    B --> D[Tool Assistant]
    C --> E[LLM Models]
    D --> F[Business Tools]
    F --> G[Service Layer]

    H[RAG Service] --> I[Embedding Store]
    H --> J[Document Loader]
    C --> H
```

### 5.2 AIé…ç½®è§„èŒƒ

#### AIæ¨¡å‹é…ç½®
```java
@Configuration
@RequiredArgsConstructor
public class ChatModelInitializer {

    private final LlmService llmService;
    private final PromptConfiguration promptConfiguration;

    @Bean
    @DependsOn("flywayInitializer")
    public OpenAiStreamingChatModel deepSeekChatModel(
            DeepSeekChatModelConfig config) {
        return OpenAiStreamingChatModel.builder()
            .baseUrl(config.getBaseUrl())
            .apiKey(config.getApiKey())
            .modelName(config.getModelName())
            .logRequests(true)
            .logResponses(true)
            .build();
    }

    @Bean
    @DependsOn("flywayInitializer")
    public AiChatAssistant deepSeekChatAssistant(
            OpenAiStreamingChatModel deepSeekChatModel) {
        return AiServices.builder(AiChatAssistant.class)
            .streamingChatModel(deepSeekChatModel)
            .systemMessageProvider(chatMemoryId -> promptConfiguration.getSystem())
            .chatMemoryProvider(memoryId -> MessageWindowChatMemory.withMaxMessages(10))
            .build();
    }
}
```

### 5.3 AIå·¥å…·å¼€å‘è§„èŒƒ

#### AIå·¥å…·ç±»ç¤ºä¾‹
```java
@Component
@RequiredArgsConstructor
@Description("ç”¨æˆ·ç®¡ç†ç›¸å…³çš„AIå·¥å…·")
public class UserOperatorTool {

    private final UserService userService;

    @Tool(value = {"åˆ›å»ºç”¨æˆ·", "æ–°å»ºç”¨æˆ·", "æ·»åŠ ç”¨æˆ·"})
    public void createUser(
            @P(value = "ç”¨æˆ·å") @Size(min = 3, max = 50) String username,
            @P(value = "é‚®ç®±åœ°å€") @Email String email,
            @P(value = "å¯†ç ", required = false) String password) {

        UserCreateDto createDto = UserCreateDto.builder()
            .username(username)
            .email(email)
            .password(StringUtils.isNotEmpty(password) ? password : "123456")
            .build();

        userService.createUser(createDto);
    }

    @Tool(value = {"åˆ é™¤ç”¨æˆ·", "ç§»é™¤ç”¨æˆ·"})
    public void deleteUser(@P(value = "ç”¨æˆ·å") String username) {
        userService.deleteUserByUsername(username);
    }
}
```

#### AIå·¥å…·è§„èŒƒè¦ç‚¹
- [ ] ä½¿ç”¨`@Tool`æ³¨è§£å®šä¹‰å·¥å…·æ–¹æ³•
- [ ] æ”¯æŒå¤šä¸ªåˆ«åæé«˜AIç†è§£å‡†ç¡®æ€§
- [ ] ä½¿ç”¨`@P`æ³¨è§£æè¿°å‚æ•°å«ä¹‰
- [ ] æ·»åŠ å‚æ•°éªŒè¯æ³¨è§£
- [ ] æŠ›å‡º`BusinessException`ä¼ é€’ç»™AI
- [ ] å·¥å…·æ–¹æ³•ä¿æŒç®€å•ï¼Œå¤æ‚é€»è¾‘å§”æ‰˜ç»™Service

### 5.4 RAGç³»ç»Ÿè§„èŒƒ

#### RAGæœåŠ¡å®ç°
```java
@Service
@RequiredArgsConstructor
@Slf4j
public class RagService {

    private final EmbeddingModel zhipuEmbeddingModel;
    private final EmbeddingStore<TextSegment> zhiPuLibraryEmbeddingStore;
    private final AmazonS3DocumentLoader amazonS3DocumentLoader;

    @Async
    public void embeddingAndCreateDocSegment(Long libraryId, Long docId, String objectName) {
        try {
            // 1. åŠ è½½æ–‡æ¡£
            Document document = amazonS3DocumentLoader.loadDocument(
                bucket, objectName, new ApacheTikaDocumentParser());

            // 2. æ–‡æ¡£åˆ†å‰²
            DocumentByParagraphSplitter splitter =
                new DocumentByParagraphSplitter(500, 150);

            // 3. å‘é‡åŒ–å­˜å‚¨
            splitter.split(document).forEach(segment -> {
                Response<Embedding> embed = zhipuEmbeddingModel.embed(segment);
                segment.metadata().put("libraryId", libraryId.toString());
                String embeddingId = zhiPuLibraryEmbeddingStore.add(embed.content(), segment);

                // 4. ä¿å­˜åˆ†æ®µä¿¡æ¯
                saveDocumentSegment(docId, embeddingId, segment, embed.tokenUsage());
            });

        } catch (Exception e) {
            log.error("æ–‡æ¡£å‘é‡åŒ–å¤±è´¥: libraryId={}, docId={}", libraryId, docId, e);
            throw new BusinessException("æ–‡æ¡£å¤„ç†å¤±è´¥: " + e.getMessage());
        }
    }
}
```

---

## å…­ã€æ•°æ®è®¿é—®å±‚è§„èŒƒ

### 6.1 JOOQ Repositoryè§„èŒƒ

#### Repositoryæ¥å£å®šä¹‰
```java
public interface UserRepository {

    /**
     * æ ¹æ®ç”¨æˆ·åæŸ¥æ‰¾ç”¨æˆ·
     */
    Optional<User> findByUsername(String username);

    /**
     * æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å­˜åœ¨
     */
    boolean existsByUsername(String username);

    /**
     * ä¿å­˜ç”¨æˆ·
     */
    User save(User user);

    /**
     * åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·
     */
    Page<User> findAll(Pageable pageable);
}
```

#### Repositoryå®ç°ç¤ºä¾‹
```java
@Repository
@RequiredArgsConstructor
public class UserRepositoryImpl implements UserRepository {

    private final DSLContext dsl;

    @Override
    public Optional<User> findByUsername(String username) {
        return dsl.selectFrom(USER)
            .where(USER.USERNAME.eq(username))
            .and(USER.DELETED.eq(false))
            .fetchOptionalInto(User.class);
    }

    @Override
    public boolean existsByUsername(String username) {
        return dsl.fetchExists(
            dsl.selectOne()
                .from(USER)
                .where(USER.USERNAME.eq(username))
                .and(USER.DELETED.eq(false))
        );
    }

    @Override
    @Transactional
    public User save(User user) {
        if (user.getId() == null) {
            // æ–°å¢
            UserRecord record = dsl.newRecord(USER, user);
            record.store();
            return record.into(User.class);
        } else {
            // æ›´æ–°
            dsl.update(USER)
                .set(USER.USERNAME, user.getUsername())
                .set(USER.EMAIL, user.getEmail())
                .set(USER.UPDATED_AT, LocalDateTime.now())
                .where(USER.ID.eq(user.getId()))
                .execute();
            return user;
        }
    }
}
```

### 6.2 æ•°æ®åº“è§„èŒƒ

#### å®ä½“ç±»è§„èŒƒ
```java
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@Table(name = "user", schema = "mjga")
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(min = 3, max = 50, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-50ä¹‹é—´")
    @Column(name = "username", nullable = false, unique = true)
    private String username;

    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    @Column(name = "email", nullable = false)
    private String email;

    @JsonIgnore
    @Column(name = "password", nullable = false)
    private String password;

    @Builder.Default
    @Column(name = "enabled", nullable = false)
    private Boolean enabled = true;

    @Builder.Default
    @Column(name = "deleted", nullable = false)
    private Boolean deleted = false;

    @CreationTimestamp
    @Column(name = "created_at", nullable = false)
    private LocalDateTime createdAt;

    @UpdateTimestamp
    @Column(name = "updated_at")
    private LocalDateTime updatedAt;
}
```

#### æ•°æ®åº“è¿ç§»è§„èŒƒ
```sql
-- V1_0_1__create_user_table.sql
CREATE TABLE mjga.user (
    id BIGSERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL,
    password VARCHAR(255) NOT NULL,
    enabled BOOLEAN NOT NULL DEFAULT true,
    deleted BOOLEAN NOT NULL DEFAULT false,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_user_username ON mjga.user(username) WHERE deleted = false;
CREATE INDEX idx_user_email ON mjga.user(email) WHERE deleted = false;

-- æ·»åŠ æ³¨é‡Š
COMMENT ON TABLE mjga.user IS 'ç”¨æˆ·è¡¨';
COMMENT ON COLUMN mjga.user.username IS 'ç”¨æˆ·å';
COMMENT ON COLUMN mjga.user.email IS 'é‚®ç®±åœ°å€';
```

---

## ä¸ƒã€å®‰å…¨ä¸æƒé™è§„èŒƒ

### 7.1 Spring Securityé…ç½®

#### å®‰å…¨é…ç½®ç¤ºä¾‹
```java
@Configuration
@EnableWebSecurity
@EnableMethodSecurity
@RequiredArgsConstructor
public class WebSecurityConfig {

    private final JwtAuthenticationEntryPoint jwtAuthenticationEntryPoint;
    private final UserDetailsService userDetailsService;
    private final JwtConfig jwtConfig;

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http.cors(corsConfigurer -> corsConfigurer.configurationSource(corsConfigurationSource()))
            .csrf(AbstractHttpConfigurer::disable)
            .authorizeHttpRequests(authorize -> authorize
                .requestMatchers(publicEndpoints()).permitAll()
                .requestMatchers("/api/v1/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated())
            .sessionManagement(session ->
                session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
            .exceptionHandling(exception -> exception
                .authenticationEntryPoint(jwtAuthenticationEntryPoint)
                .accessDeniedHandler(jwtAccessDeniedHandler()))
            .addFilterBefore(jwtAuthenticationFilter(),
                UsernamePasswordAuthenticationFilter.class);

        return http.build();
    }

    private String[] publicEndpoints() {
        return new String[]{
            "/api/v1/auth/**",
            "/swagger-ui/**",
            "/v3/api-docs/**",
            "/actuator/health"
        };
    }
}
```

### 7.2 æƒé™æ§åˆ¶è§„èŒƒ

#### æƒé™æ³¨è§£ä½¿ç”¨
```java
@RestController
@RequestMapping("/api/v1/users")
@PreAuthorize("hasRole('USER_MANAGER')")
public class UserController {

    @PostMapping
    @PreAuthorize("hasAuthority('CREATE_USER')")
    public ResponseEntity<ApiResponse<UserResponseDto>> createUser(@RequestBody @Valid UserCreateDto createDto) {
        // åˆ›å»ºç”¨æˆ·é€»è¾‘
    }

    @DeleteMapping("/{id}")
    @PreAuthorize("hasAuthority('DELETE_USER') and #id != authentication.principal.id")
    public ResponseEntity<ApiResponse<Void>> deleteUser(@PathVariable Long id) {
        // åˆ é™¤ç”¨æˆ·é€»è¾‘ï¼ˆä¸èƒ½åˆ é™¤è‡ªå·±ï¼‰
    }
}
```

---

## å…«ã€å¼‚å¸¸å¤„ç†è§„èŒƒ

### 8.1 å¼‚å¸¸åˆ†å±‚è®¾è®¡

#### ä¸šåŠ¡å¼‚å¸¸å®šä¹‰
```java
public class BusinessException extends RuntimeException {

    private final String errorCode;
    private final Object[] args;

    public BusinessException(String message) {
        super(message);
        this.errorCode = "BUSINESS_ERROR";
        this.args = new Object[0];
    }

    public BusinessException(String errorCode, String message, Object... args) {
        super(message);
        this.errorCode = errorCode;
        this.args = args;
    }

    // getters...
}
```

#### å…¨å±€å¼‚å¸¸å¤„ç†å™¨
```java
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler extends ResponseEntityExceptionHandler {

    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<ApiResponse<Void>> handleBusinessException(
            BusinessException ex, WebRequest request) {
        log.warn("ä¸šåŠ¡å¼‚å¸¸: {}", ex.getMessage());

        ApiResponse<Void> response = ApiResponse.error(ex.getMessage());
        return ResponseEntity.badRequest().body(response);
    }

    @Override
    protected ResponseEntity<Object> handleMethodArgumentNotValid(
            MethodArgumentNotValidException ex,
            HttpHeaders headers,
            HttpStatusCode status,
            WebRequest request) {

        String errorMessage = ex.getBindingResult()
            .getFieldErrors()
            .stream()
            .map(error -> error.getField() + ": " + error.getDefaultMessage())
            .collect(Collectors.joining(", "));

        log.warn("å‚æ•°éªŒè¯å¤±è´¥: {}", errorMessage);

        ApiResponse<Void> response = ApiResponse.error("å‚æ•°éªŒè¯å¤±è´¥: " + errorMessage);
        return ResponseEntity.badRequest().body(response);
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<ApiResponse<Void>> handleGenericException(
            Exception ex, WebRequest request) {
        log.error("ç³»ç»Ÿå¼‚å¸¸", ex);

        ApiResponse<Void> response = ApiResponse.error("ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·è”ç³»ç®¡ç†å‘˜");
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(response);
    }
}
```

### 8.2 ç»Ÿä¸€å“åº”æ ¼å¼

#### ApiResponseå®šä¹‰
```java
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ApiResponse<T> {

    private String code;
    private String message;
    private T data;
    private Long timestamp;

    public static <T> ApiResponse<T> success(T data) {
        return ApiResponse.<T>builder()
            .code("SUCCESS")
            .message("æ“ä½œæˆåŠŸ")
            .data(data)
            .timestamp(System.currentTimeMillis())
            .build();
    }

    public static <T> ApiResponse<T> error(String message) {
        return ApiResponse.<T>builder()
            .code("ERROR")
            .message(message)
            .timestamp(System.currentTimeMillis())
            .build();
    }
}
```

---

## ä¹ã€æµ‹è¯•è§„èŒƒ

### 9.1 æµ‹è¯•åˆ†å±‚ç­–ç•¥

#### æµ‹è¯•é‡‘å­—å¡”
```mermaid
graph TB
    A[E2E Tests<br/>ç«¯åˆ°ç«¯æµ‹è¯•] --> B[Integration Tests<br/>é›†æˆæµ‹è¯•]
    B --> C[Unit Tests<br/>å•å…ƒæµ‹è¯•]

    style A fill:#ff9999
    style B fill:#ffcc99
    style C fill:#99ff99
```

### 9.2 å•å…ƒæµ‹è¯•è§„èŒƒ

#### Serviceå±‚å•å…ƒæµ‹è¯•
```java
@ExtendWith(MockitoExtension.class)
class UserServiceImplTest {

    @Mock
    private UserRepository userRepository;

    @Mock
    private PasswordEncoder passwordEncoder;

    @InjectMocks
    private UserServiceImpl userService;

    @Test
    @DisplayName("åˆ›å»ºç”¨æˆ· - æˆåŠŸåœºæ™¯")
    void createUser_Success() {
        // Given
        UserCreateDto createDto = UserCreateDto.builder()
            .username("testuser")
            .email("test@example.com")
            .password("password123")
            .build();

        User savedUser = User.builder()
            .id(1L)
            .username("testuser")
            .email("test@example.com")
            .password("encoded_password")
            .enabled(true)
            .build();

        when(userRepository.existsByUsername("testuser")).thenReturn(false);
        when(passwordEncoder.encode("password123")).thenReturn("encoded_password");
        when(userRepository.save(any(User.class))).thenReturn(savedUser);

        // When
        UserResponseDto result = userService.createUser(createDto);

        // Then
        assertThat(result).isNotNull();
        assertThat(result.getUsername()).isEqualTo("testuser");
        assertThat(result.getEmail()).isEqualTo("test@example.com");

        verify(userRepository).existsByUsername("testuser");
        verify(passwordEncoder).encode("password123");
        verify(userRepository).save(any(User.class));
    }

    @Test
    @DisplayName("åˆ›å»ºç”¨æˆ· - ç”¨æˆ·åå·²å­˜åœ¨")
    void createUser_UsernameExists_ThrowsException() {
        // Given
        UserCreateDto createDto = UserCreateDto.builder()
            .username("existinguser")
            .email("test@example.com")
            .password("password123")
            .build();

        when(userRepository.existsByUsername("existinguser")).thenReturn(true);

        // When & Then
        assertThatThrownBy(() -> userService.createUser(createDto))
            .isInstanceOf(BusinessException.class)
            .hasMessageContaining("ç”¨æˆ·åå·²å­˜åœ¨");

        verify(userRepository).existsByUsername("existinguser");
        verify(userRepository, never()).save(any(User.class));
    }
}
```

### 9.3 é›†æˆæµ‹è¯•è§„èŒƒ

#### TestContainersé›†æˆæµ‹è¯•
```java
@SpringBootTest
@Testcontainers
@TestMethodOrder(OrderAnnotation.class)
class UserIntegrationTest {

    @Container
    static PostgreSQLContainer<?> postgres = new PostgreSQLContainer<>("postgres:17")
        .withDatabaseName("testdb")
        .withUsername("test")
        .withPassword("test");

    @Autowired
    private TestRestTemplate restTemplate;

    @Autowired
    private UserRepository userRepository;

    @DynamicPropertySource
    static void configureProperties(DynamicPropertyRegistry registry) {
        registry.add("spring.datasource.url", postgres::getJdbcUrl);
        registry.add("spring.datasource.username", postgres::getUsername);
        registry.add("spring.datasource.password", postgres::getPassword);
    }

    @Test
    @Order(1)
    @DisplayName("åˆ›å»ºç”¨æˆ·API - é›†æˆæµ‹è¯•")
    void createUser_IntegrationTest() {
        // Given
        UserCreateDto createDto = UserCreateDto.builder()
            .username("integrationtest")
            .email("integration@test.com")
            .password("password123")
            .build();

        // When
        ResponseEntity<ApiResponse> response = restTemplate.postForEntity(
            "/api/v1/users", createDto, ApiResponse.class);

        // Then
        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(response.getBody().getCode()).isEqualTo("SUCCESS");

        // éªŒè¯æ•°æ®åº“
        Optional<User> savedUser = userRepository.findByUsername("integrationtest");
        assertThat(savedUser).isPresent();
        assertThat(savedUser.get().getEmail()).isEqualTo("integration@test.com");
    }
}
```

### 9.4 AIç³»ç»Ÿæµ‹è¯•è§„èŒƒ

#### AIå·¥å…·æµ‹è¯•
```java
@ExtendWith(MockitoExtension.class)
class UserOperatorToolTest {

    @Mock
    private UserService userService;

    @InjectMocks
    private UserOperatorTool userOperatorTool;

    @Test
    @DisplayName("AIåˆ›å»ºç”¨æˆ·å·¥å…· - æˆåŠŸåœºæ™¯")
    void createUser_Success() {
        // Given
        String username = "aiuser";
        String email = "ai@test.com";
        String password = "password123";

        // When
        assertDoesNotThrow(() ->
            userOperatorTool.createUser(username, email, password));

        // Then
        ArgumentCaptor<UserCreateDto> captor = ArgumentCaptor.forClass(UserCreateDto.class);
        verify(userService).createUser(captor.capture());

        UserCreateDto captured = captor.getValue();
        assertThat(captured.getUsername()).isEqualTo(username);
        assertThat(captured.getEmail()).isEqualTo(email);
        assertThat(captured.getPassword()).isEqualTo(password);
    }

    @Test
    @DisplayName("AIåˆ›å»ºç”¨æˆ·å·¥å…· - ä¸šåŠ¡å¼‚å¸¸ä¼ æ’­")
    void createUser_BusinessException_Propagated() {
        // Given
        when(userService.createUser(any(UserCreateDto.class)))
            .thenThrow(new BusinessException("ç”¨æˆ·åå·²å­˜åœ¨"));

        // When & Then
        assertThatThrownBy(() ->
            userOperatorTool.createUser("existing", "test@test.com", "pass"))
            .isInstanceOf(BusinessException.class)
            .hasMessageContaining("ç”¨æˆ·åå·²å­˜åœ¨");
    }
}
```

---

## åã€ä»£ç è´¨é‡è§„èŒƒ

### 10.1 é™æ€ä»£ç åˆ†æ

#### PMDè§„åˆ™é…ç½®
```xml
<!-- pmd-rules.xml -->
<?xml version="1.0"?>
<ruleset name="çŸ¥è·¯é¡¹ç›®PMDè§„åˆ™"
         xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0
                             https://pmd.sourceforge.io/ruleset_2_0_0.xsd">

    <description>çŸ¥è·¯é¡¹ç›®è‡ªå®šä¹‰PMDè§„åˆ™é›†</description>

    <!-- æœ€ä½³å®è·µè§„åˆ™ -->
    <rule ref="category/java/bestpractices.xml">
        <exclude name="GuardLogStatement"/>
        <exclude name="AvoidReassigningParameters"/>
    </rule>

    <!-- é”™è¯¯å€¾å‘è§„åˆ™ -->
    <rule ref="category/java/errorprone.xml">
        <exclude name="AvoidLiteralsInIfCondition"/>
        <exclude name="AvoidDuplicateLiterals"/>
    </rule>

    <!-- ä»£ç é£æ ¼è§„åˆ™ -->
    <rule ref="category/java/codestyle.xml/ClassNamingConventions"/>
    <rule ref="category/java/codestyle.xml/MethodNamingConventions"/>
    <rule ref="category/java/codestyle.xml/VariableNamingConventions"/>

    <!-- æ€§èƒ½è§„åˆ™ -->
    <rule ref="category/java/performance.xml"/>

    <!-- å®‰å…¨è§„åˆ™ -->
    <rule ref="category/java/security.xml"/>
</ruleset>
```

### 10.2 ä»£ç æ ¼å¼åŒ–é…ç½®

#### Spotlessé…ç½®
```kotlin
// build.gradle.kts
spotless {
    java {
        // ä½¿ç”¨Google Javaæ ¼å¼
        googleJavaFormat("1.28.0").reflowLongStrings()

        // æ ¼å¼åŒ–æ³¨è§£
        formatAnnotations()

        // ç§»é™¤æœªä½¿ç”¨çš„å¯¼å…¥
        removeUnusedImports()

        // è‡ªå®šä¹‰æ ¼å¼åŒ–è§„åˆ™
        custom("noWildcardImports") { content ->
            if (content.contains("import .*\\*;".toRegex())) {
                throw RuntimeException("ä¸å…è®¸ä½¿ç”¨é€šé…ç¬¦å¯¼å…¥")
            }
            content
        }
    }

    kotlin {
        ktlint("1.0.1")
    }

    format("misc") {
        target("*.gradle.kts", "*.md", ".gitignore")
        trimTrailingWhitespace()
        leadingTabsToSpaces()
        endWithNewline()
    }
}
```

### 10.3 æµ‹è¯•è¦†ç›–ç‡é…ç½®

#### JaCoCoé…ç½®
```kotlin
// build.gradle.kts
jacoco {
    toolVersion = "0.8.13"
    reportsDirectory.set(layout.buildDirectory.dir("reports/jacoco"))
}

tasks.jacocoTestReport {
    dependsOn(tasks.test)

    reports {
        xml.required.set(true)
        html.required.set(true)
        csv.required.set(false)
    }

    finalizedBy(tasks.jacocoTestCoverageVerification)
}

tasks.jacocoTestCoverageVerification {
    violationRules {
        rule {
            limit {
                minimum = "0.80".toBigDecimal() // 80%è¦†ç›–ç‡è¦æ±‚
            }
        }

        rule {
            element = "CLASS"
            excludes = listOf(
                "*.config.*",
                "*.dto.*",
                "*.exception.*",
                "*Application"
            )

            limit {
                counter = "LINE"
                value = "COVEREDRATIO"
                minimum = "0.75".toBigDecimal()
            }
        }
    }
}
```

---

## åä¸€ã€éƒ¨ç½²ä¸è¿ç»´è§„èŒƒ

### 11.1 DockeråŒ–éƒ¨ç½²

#### Dockerfileè§„èŒƒ
```dockerfile
# å¤šé˜¶æ®µæ„å»º
FROM gradle:8.13-jdk21 AS builder

WORKDIR /app
COPY build.gradle.kts settings.gradle.kts ./
COPY src ./src

# æ„å»ºåº”ç”¨
RUN gradle clean build -x test --no-daemon

# è¿è¡Œæ—¶é•œåƒ
FROM openjdk:21-jre-slim

# åˆ›å»ºåº”ç”¨ç”¨æˆ·
RUN groupadd -r appuser && useradd -r -g appuser appuser

# å®‰è£…å¿…è¦å·¥å…·
RUN apt-get update && apt-get install -y \
    curl \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# å¤åˆ¶åº”ç”¨æ–‡ä»¶
COPY --from=builder /app/build/libs/backend.jar app.jar

# è®¾ç½®æ–‡ä»¶æƒé™
RUN chown -R appuser:appuser /app
USER appuser

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:8080/actuator/health || exit 1

# æš´éœ²ç«¯å£
EXPOSE 8080

# å¯åŠ¨åº”ç”¨
ENTRYPOINT ["java", "-jar", "app.jar"]
```

#### Docker Composeé…ç½®
```yaml
# docker-compose.yml
version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "8080:8080"
    environment:
      - DATABASE_HOST_PORT=postgres:5432
      - DATABASE_DB=zhilu
      - DATABASE_USER=zhilu
      - DATABASE_PASSWORD=zhilu123
      - JWT_SECRET=your-secret-key
      - MINIO_ENDPOINT=http://minio:9000
    depends_on:
      postgres:
        condition: service_healthy
      minio:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  postgres:
    image: pgvector/pgvector:pg17
    environment:
      POSTGRES_DB: zhilu
      POSTGRES_USER: zhilu
      POSTGRES_PASSWORD: zhilu123
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U zhilu"]
      interval: 10s
      timeout: 5s
      retries: 5

  minio:
    image: minio/minio:latest
    command: server /data --console-address ":9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin123
    ports:
      - "9000:9000"
      - "9001:9001"
    volumes:
      - minio_data:/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 20s
      retries: 3

volumes:
  postgres_data:
  minio_data:
```

### 11.2 ç¯å¢ƒé…ç½®ç®¡ç†

#### ç¯å¢ƒå˜é‡é…ç½®
```bash
# .env.example
# æ•°æ®åº“é…ç½®
DATABASE_HOST_PORT=localhost:5432
DATABASE_DB=zhilu
DATABASE_USER=zhilu
DATABASE_PASSWORD=zhilu123
DATABASE_DEFAULT_SCHEMA=mjga
DATABASE_EXPOSE_PORT=5432

# JWTé…ç½®
JWT_SECRET=your-super-secret-jwt-key-here
JWT_EXPIRATION_MIN=1440

# MinIOé…ç½®
MINIO_ENDPOINT=http://localhost:9000
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin123
MINIO_DEFAULT_BUCKETS=zhilu-bucket

# CORSé…ç½®
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:4173
ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
ALLOWED_HEADERS=*
ALLOWED_EXPOSE_HEADERS=*

# AIæ¨¡å‹é…ç½®
DEEPSEEK_API_KEY=your-deepseek-api-key
ZHIPU_API_KEY=your-zhipu-api-key
```

### 11.3 ç›‘æ§ä¸æ—¥å¿—

#### åº”ç”¨ç›‘æ§é…ç½®
```yaml
# application.yml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true

logging:
  level:
    com.zl.mjga: INFO
    dev.langchain4j: DEBUG
    org.springframework.security: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: /var/log/zhilu/application.log
    max-size: 100MB
    max-history: 30
```

---

## åäºŒã€ä»£ç é£æ ¼è§„èŒƒ

### 12.1 å‘½åè§„èŒƒ

| ç±»å‹ | è§„èŒƒ | ç¤ºä¾‹ |
|------|------|------|
| ç±»å | UpperCamelCase | `UserService`, `AiChatController` |
| æ–¹æ³•å | lowerCamelCase | `createUser`, `findByUsername` |
| å˜é‡å | lowerCamelCase | `userName`, `apiResponse` |
| å¸¸é‡ | UPPER_SNAKE_CASE | `MAX_RETRY_COUNT`, `DEFAULT_PAGE_SIZE` |
| åŒ…å | lowercase | `com.zl.mjga.service` |
| æšä¸¾ | UpperCamelCase | `UserStatus`, `LlmCodeEnum` |

### 12.2 æ³¨é‡Šè§„èŒƒ

#### Javadocæ³¨é‡Š
```java
/**
 * ç”¨æˆ·æœåŠ¡æ¥å£
 *
 * <p>æä¾›ç”¨æˆ·ç›¸å…³çš„ä¸šåŠ¡æ“ä½œï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤ç­‰åŠŸèƒ½ã€‚
 * æ‰€æœ‰æ–¹æ³•éƒ½ä¼šè¿›è¡Œæƒé™éªŒè¯å’Œæ•°æ®æ ¡éªŒã€‚</p>
 *
 * @author çŸ¥è·¯å›¢é˜Ÿ
 * @version 1.0.0
 * @since 2025-01-20
 */
public interface UserService {

    /**
     * åˆ›å»ºæ–°ç”¨æˆ·
     *
     * @param createDto ç”¨æˆ·åˆ›å»ºä¿¡æ¯ï¼Œä¸èƒ½ä¸ºnull
     * @return åˆ›å»ºæˆåŠŸçš„ç”¨æˆ·ä¿¡æ¯
     * @throws BusinessException å½“ç”¨æˆ·åå·²å­˜åœ¨æˆ–æ•°æ®éªŒè¯å¤±è´¥æ—¶
     * @throws IllegalArgumentException å½“å‚æ•°ä¸ºnullæ—¶
     */
    UserResponseDto createUser(@NonNull UserCreateDto createDto);
}
```

#### è¡Œå†…æ³¨é‡Šè§„èŒƒ
```java
public class UserServiceImpl implements UserService {

    @Override
    public UserResponseDto createUser(UserCreateDto createDto) {
        // TODO: æ·»åŠ ç”¨æˆ·åˆ›å»ºäº‹ä»¶å‘å¸ƒ
        // FIXME: éœ€è¦ä¼˜åŒ–å¯†ç åŠ å¯†æ€§èƒ½

        // 1. éªŒè¯ç”¨æˆ·åå”¯ä¸€æ€§
        if (userRepository.existsByUsername(createDto.getUsername())) {
            throw new BusinessException("ç”¨æˆ·åå·²å­˜åœ¨");
        }

        // 2. åŠ å¯†å¯†ç 
        String encodedPassword = passwordEncoder.encode(createDto.getPassword());

        // 3. æ„å»ºç”¨æˆ·å®ä½“
        User user = User.builder()
            .username(createDto.getUsername())
            .password(encodedPassword)
            .build();

        return UserResponseDto.fromEntity(userRepository.save(user));
    }
}
```

### 12.3 ä»£ç ç»„ç»‡è§„èŒƒ

#### ç±»å†…éƒ¨ç»“æ„é¡ºåº
```java
public class UserController {

    // 1. é™æ€å¸¸é‡
    private static final String API_PREFIX = "/api/v1/users";

    // 2. å®ä¾‹å­—æ®µ
    private final UserService userService;
    private final UserMapper userMapper;

    // 3. æ„é€ å‡½æ•°
    public UserController(UserService userService, UserMapper userMapper) {
        this.userService = userService;
        this.userMapper = userMapper;
    }

    // 4. å…¬å…±æ–¹æ³•
    @PostMapping
    public ResponseEntity<ApiResponse<UserResponseDto>> createUser(@RequestBody @Valid UserCreateDto createDto) {
        // å®ç°é€»è¾‘
    }

    // 5. ç§æœ‰æ–¹æ³•
    private void validateUserData(UserCreateDto createDto) {
        // éªŒè¯é€»è¾‘
    }

    // 6. é™æ€æ–¹æ³•
    public static String formatUsername(String username) {
        return username.toLowerCase().trim();
    }
}
```

---

## åä¸‰ã€æ€§èƒ½ä¼˜åŒ–è§„èŒƒ

### 13.1 æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–

#### æŸ¥è¯¢ä¼˜åŒ–è§„èŒƒ
```java
@Repository
public class UserRepositoryImpl implements UserRepository {

    // âœ… æ­£ç¡®ï¼šä½¿ç”¨ç´¢å¼•å­—æ®µæŸ¥è¯¢
    public Optional<User> findByUsername(String username) {
        return dsl.selectFrom(USER)
            .where(USER.USERNAME.eq(username))
            .and(USER.DELETED.eq(false))
            .fetchOptionalInto(User.class);
    }

    // âœ… æ­£ç¡®ï¼šæ‰¹é‡æŸ¥è¯¢é¿å…N+1é—®é¢˜
    public List<User> findUsersWithRoles(List<Long> userIds) {
        return dsl.select()
            .from(USER)
            .leftJoin(USER_ROLE_MAP).on(USER.ID.eq(USER_ROLE_MAP.USER_ID))
            .leftJoin(ROLE).on(USER_ROLE_MAP.ROLE_ID.eq(ROLE.ID))
            .where(USER.ID.in(userIds))
            .fetchInto(User.class);
    }

    // âŒ é”™è¯¯ï¼šåœ¨å¾ªç¯ä¸­æ‰§è¡ŒæŸ¥è¯¢
    public void updateUserRoles(List<Long> userIds, Long roleId) {
        for (Long userId : userIds) {
            // è¿™ä¼šå¯¼è‡´Næ¬¡æ•°æ®åº“æŸ¥è¯¢
            dsl.insertInto(USER_ROLE_MAP)
                .set(USER_ROLE_MAP.USER_ID, userId)
                .set(USER_ROLE_MAP.ROLE_ID, roleId)
                .execute();
        }
    }

    // âœ… æ­£ç¡®ï¼šæ‰¹é‡æ“ä½œ
    public void updateUserRolesBatch(List<Long> userIds, Long roleId) {
        List<UserRoleMapRecord> records = userIds.stream()
            .map(userId -> {
                UserRoleMapRecord record = dsl.newRecord(USER_ROLE_MAP);
                record.setUserId(userId);
                record.setRoleId(roleId);
                return record;
            })
            .toList();

        dsl.batchInsert(records).execute();
    }
}
```

### 13.2 ç¼“å­˜ç­–ç•¥

#### ç¼“å­˜é…ç½®
```java
@Configuration
@EnableCaching
public class CacheConfig {

    @Bean
    public CacheManager cacheManager() {
        CaffeineCacheManager cacheManager = new CaffeineCacheManager();
        cacheManager.setCaffeine(Caffeine.newBuilder()
            .maximumSize(1000)
            .expireAfterWrite(Duration.ofMinutes(30))
            .recordStats());
        return cacheManager;
    }
}

@Service
public class UserServiceImpl implements UserService {

    @Cacheable(value = "users", key = "#username")
    public UserResponseDto getUserByUsername(String username) {
        // æŸ¥è¯¢é€»è¾‘
    }

    @CacheEvict(value = "users", key = "#user.username")
    public UserResponseDto updateUser(UserUpdateDto updateDto) {
        // æ›´æ–°é€»è¾‘
    }

    @CacheEvict(value = "users", allEntries = true)
    public void clearUserCache() {
        // æ¸…é™¤æ‰€æœ‰ç”¨æˆ·ç¼“å­˜
    }
}
```

---

## åå››ã€æœ€ä½³å®è·µæ€»ç»“

### 14.1 å¼€å‘æµç¨‹æ£€æŸ¥æ¸…å•

#### ä»£ç æäº¤å‰æ£€æŸ¥
- [ ] ä»£ç æ ¼å¼åŒ–ï¼šè¿è¡Œ `./gradlew spotlessApply`
- [ ] é™æ€åˆ†æï¼šè¿è¡Œ `./gradlew pmdMain`
- [ ] å•å…ƒæµ‹è¯•ï¼šè¿è¡Œ `./gradlew test`
- [ ] æµ‹è¯•è¦†ç›–ç‡ï¼šç¡®ä¿è¦†ç›–ç‡ â‰¥ 80%
- [ ] é›†æˆæµ‹è¯•ï¼šè¿è¡Œ `./gradlew integrationTest`
- [ ] APIæ–‡æ¡£ï¼šæ›´æ–°OpenAPIæ–‡æ¡£
- [ ] æ•°æ®åº“è¿ç§»ï¼šæ£€æŸ¥Flywayè„šæœ¬

#### Code Reviewæ£€æŸ¥ç‚¹
- [ ] æ˜¯å¦éµå¾ªSOLIDåŸåˆ™
- [ ] å¼‚å¸¸å¤„ç†æ˜¯å¦å®Œå–„
- [ ] æ˜¯å¦æœ‰é€‚å½“çš„æ—¥å¿—è®°å½•
- [ ] å®‰å…¨æ€§è€ƒè™‘æ˜¯å¦å……åˆ†
- [ ] æ€§èƒ½æ˜¯å¦æœ‰ä¼˜åŒ–ç©ºé—´
- [ ] æµ‹è¯•ç”¨ä¾‹æ˜¯å¦å……åˆ†
- [ ] æ–‡æ¡£æ˜¯å¦å®Œæ•´

### 14.2 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

#### é—®é¢˜1ï¼šAIå·¥å…·è°ƒç”¨å¤±è´¥
```java
// é—®é¢˜ï¼šAIå·¥å…·æ–¹æ³•æŠ›å‡ºæœªå¤„ç†å¼‚å¸¸
@Tool("åˆ›å»ºç”¨æˆ·")
public void createUser(String username) {
    userRepository.save(user); // å¯èƒ½æŠ›å‡ºDataAccessException
}

// è§£å†³ï¼šç»Ÿä¸€å¼‚å¸¸å¤„ç†
@Tool("åˆ›å»ºç”¨æˆ·")
public void createUser(String username) {
    try {
        userRepository.save(user);
    } catch (DataAccessException e) {
        throw new BusinessException("ç”¨æˆ·åˆ›å»ºå¤±è´¥: " + e.getMessage());
    }
}
```

#### é—®é¢˜2ï¼šå¾ªç¯ä¾èµ–
```java
// é—®é¢˜ï¼šæœåŠ¡é—´å¾ªç¯ä¾èµ–
@Service
public class UserService {
    @Autowired
    private RoleService roleService; // RoleServiceä¹Ÿä¾èµ–UserService
}

// è§£å†³ï¼šå¼•å…¥ä¸­é—´æœåŠ¡æˆ–äº‹ä»¶é©±åŠ¨
@Service
public class UserRoleService {
    private final UserRepository userRepository;
    private final RoleRepository roleRepository;

    public void assignRole(Long userId, Long roleId) {
        // å¤„ç†ç”¨æˆ·è§’è‰²å…³è”é€»è¾‘
    }
}
```

---

## åäº”ã€é™„å½•

### 15.1 å¼€å‘å·¥å…·æ¨è

#### IDEé…ç½®
- **IntelliJ IDEA Ultimate** (æ¨è)
- **æ’ä»¶**ï¼š
  - Lombok Plugin
  - SonarLint
  - CheckStyle-IDEA
  - Docker
  - Database Navigator

#### å¼€å‘ç¯å¢ƒ
```bash
# Javaç¯å¢ƒ
java -version  # OpenJDK 21

# Dockerç¯å¢ƒ
docker --version  # 27+
docker-compose --version  # 2.0+

# æ•°æ®åº“å·¥å…·
psql --version  # PostgreSQL 17+
```

### 15.2 å‚è€ƒèµ„æº

- [Spring Bootå®˜æ–¹æ–‡æ¡£](https://spring.io/projects/spring-boot)
- [LangChain4jæ–‡æ¡£](https://docs.langchain4j.dev/)
- [JOOQå®˜æ–¹æ–‡æ¡£](https://www.jooq.org/doc/latest/manual/)
- [TestContainersæ–‡æ¡£](https://testcontainers.com/)
- [çŸ¥è·¯é¡¹ç›®GitHub](https://github.com/ccmjga/zhilu-admin)

---

**ğŸ“ æ–‡æ¡£ç»´æŠ¤**ï¼šæœ¬è§„èŒƒæ–‡æ¡£åº”éšé¡¹ç›®å‘å±•æŒç»­æ›´æ–°ï¼Œç¡®ä¿ä¸å®é™…ä»£ç ä¿æŒä¸€è‡´ã€‚

**ğŸ¯ ç›®æ ‡**ï¼šé€šè¿‡éµå¾ªæœ¬è§„èŒƒï¼Œç¡®ä¿çŸ¥è·¯é¡¹ç›®ä»£ç è´¨é‡é«˜ã€å¯ç»´æŠ¤æ€§å¼ºã€å®‰å…¨æ€§å¥½ã€‚
```
