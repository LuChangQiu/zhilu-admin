# ğŸ¯ çŸ¥è·¯æ¡†æ¶æ·±åº¦å­¦ä¹ è·¯çº¿å›¾

> **å­¦ä¹ ç›®æ ‡**ï¼šå…¨é¢æŒæ¡çŸ¥è·¯æ¡†æ¶çš„æ¶æ„è®¾è®¡ã€AIé›†æˆã€ä»£ç è§„èŒƒå’Œæœ€ä½³å®è·µ

## ğŸ“š å­¦ä¹ é˜¶æ®µæ¦‚è§ˆ

```mermaid
graph TD
    A[é˜¶æ®µ1: é¡¹ç›®ç»“æ„ç†è§£] --> B[é˜¶æ®µ2: æ ¸å¿ƒæ¶æ„åˆ†æ]
    B --> C[é˜¶æ®µ3: AIç³»ç»Ÿæ·±å…¥]
    C --> D[é˜¶æ®µ4: ä¸šåŠ¡é€»è¾‘å­¦ä¹ ]
    D --> E[é˜¶æ®µ5: æµ‹è¯•ä¸è´¨é‡]
    E --> F[é˜¶æ®µ6: éƒ¨ç½²ä¸è¿ç»´]
```

---

## ğŸ—ï¸ é˜¶æ®µ1ï¼šé¡¹ç›®ç»“æ„ç†è§£ (1-2å¤©)

### 1.1 é¡¹ç›®æ•´ä½“ç»“æ„
**ç›®æ ‡**ï¼šç†è§£é¡¹ç›®çš„æ•´ä½“æ¶æ„å’Œæ¨¡å—åˆ’åˆ†

#### ğŸ“ æ ¸å¿ƒç›®å½•ç»“æ„
```
backend/
â”œâ”€â”€ src/main/java/com/zl/mjga/
â”‚   â”œâ”€â”€ config/          # é…ç½®ç±»
â”‚   â”œâ”€â”€ controller/      # æ§åˆ¶å™¨å±‚
â”‚   â”œâ”€â”€ service/         # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ repository/      # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ component/       # ç»„ä»¶ç±»
â”‚   â”œâ”€â”€ dto/            # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ exception/      # å¼‚å¸¸å¤„ç†
â”‚   â””â”€â”€ model/          # æ¨¡å‹ç±»
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ db/migration/   # æ•°æ®åº“è¿ç§»
â”‚   â””â”€â”€ prompt.txt      # AIæç¤ºè¯
â””â”€â”€ build.gradle.kts    # æ„å»ºé…ç½®
```

#### ğŸ¯ å­¦ä¹ é‡ç‚¹
- [ ] æŸ¥çœ‹ `build.gradle.kts` - äº†è§£æŠ€æœ¯æ ˆå’Œä¾èµ–
- [ ] é˜…è¯» `README.md` - ç†è§£é¡¹ç›®å®šä½å’Œç‰¹è‰²
- [ ] æµè§ˆ `src/main/resources/application.yml` - é…ç½®æ–‡ä»¶ç»“æ„

### 1.2 æŠ€æœ¯æ ˆåˆ†æ
**é‡ç‚¹æ–‡ä»¶**ï¼š[`build.gradle.kts`](backend/build.gradle.kts)

#### ğŸ” å…³é”®ä¾èµ–åˆ†æ
- **Spring Boot 3.3.9** - ç°ä»£åŒ–Springæ¡†æ¶
- **Java 21** - æœ€æ–°LTSç‰ˆæœ¬ç‰¹æ€§
- **LangChain4j** - AIé›†æˆæ ¸å¿ƒæ¡†æ¶
- **JOOQ** - ç±»å‹å®‰å…¨çš„SQLæ„å»º
- **PostgreSQL + pgvector** - å‘é‡æ•°æ®åº“æ”¯æŒ
- **TestContainers** - é›†æˆæµ‹è¯•å®¹å™¨åŒ–

---

## ğŸ›ï¸ é˜¶æ®µ2ï¼šæ ¸å¿ƒæ¶æ„åˆ†æ (2-3å¤©)

### 2.1 Spring Booté…ç½®ä½“ç³»
**ç›®æ ‡**ï¼šç†è§£ç°ä»£åŒ–çš„é…ç½®ç®¡ç†å’Œä¾èµ–æ³¨å…¥

#### ğŸ“‹ é…ç½®ç±»å­¦ä¹ é¡ºåº
1. **[`MjgaApplication.java`](backend/src/main/java/com/zl/mjga/MjgaApplication.java)** - åº”ç”¨å¯åŠ¨ç±»
2. **[`SecurityConfig.java`](backend/src/main/java/com/zl/mjga/config/SecurityConfig.java)** - å®‰å…¨é…ç½®
3. **[`DatabaseConfig.java`](backend/src/main/java/com/zl/mjga/config/DatabaseConfig.java)** - æ•°æ®åº“é…ç½®
4. **[`CacheConfig.java`](backend/src/main/java/com/zl/mjga/config/CacheConfig.java)** - ç¼“å­˜é…ç½®

#### ğŸ¯ å­¦ä¹ é‡ç‚¹
- [ ] **ä¾èµ–æ³¨å…¥æ¨¡å¼** - ç†è§£`@RequiredArgsConstructor`çš„ä½¿ç”¨
- [ ] **é…ç½®å±æ€§ç»‘å®š** - `@ConfigurationProperties`çš„åº”ç”¨
- [ ] **æ¡ä»¶åŒ–é…ç½®** - `@ConditionalOnProperty`ç­‰æ³¨è§£
- [ ] **Beanç”Ÿå‘½å‘¨æœŸ** - `@PostConstruct`ã€`@DependsOn`çš„ä½¿ç”¨

### 2.2 æ•°æ®è®¿é—®å±‚æ¶æ„
**ç›®æ ‡**ï¼šæŒæ¡JOOQ + Repositoryæ¨¡å¼çš„ç°ä»£åŒ–æ•°æ®è®¿é—®

#### ğŸ“Š æ•°æ®å±‚æ ¸å¿ƒæ–‡ä»¶
1. **[`DatabaseConfig.java`](backend/src/main/java/com/zl/mjga/config/DatabaseConfig.java)** - æ•°æ®æºé…ç½®
2. **[`UserRepository.java`](backend/src/main/java/com/zl/mjga/repository/UserRepository.java)** - Repositoryå®ç°
3. **[`IdentityAccessService.java`](backend/src/main/java/com/zl/mjga/service/IdentityAccessService.java)** - é¢†åŸŸæœåŠ¡

#### ğŸ” å­¦ä¹ è¦ç‚¹
- [ ] **JOOQä»£ç ç”Ÿæˆ** - ç±»å‹å®‰å…¨çš„SQLæ“ä½œ
- [ ] **Repositoryæ¨¡å¼** - æ•°æ®è®¿é—®æŠ½è±¡
- [ ] **äº‹åŠ¡ç®¡ç†** - `@Transactional`çš„ä½¿ç”¨
- [ ] **æ•°æ®åº“è¿ç§»** - Flywayçš„ç‰ˆæœ¬æ§åˆ¶

### 2.3 å¼‚å¸¸å¤„ç†ä½“ç³»
**ç›®æ ‡**ï¼šç†è§£ç»Ÿä¸€å¼‚å¸¸å¤„ç†å’Œé”™è¯¯å“åº”æœºåˆ¶

#### ğŸš¨ å¼‚å¸¸å¤„ç†æ ¸å¿ƒ
1. **[`GlobalExceptionHandler.java`](backend/src/main/java/com/zl/mjga/exception/GlobalExceptionHandler.java)** - å…¨å±€å¼‚å¸¸å¤„ç†
2. **[`BusinessException.java`](backend/src/main/java/com/zl/mjga/exception/BusinessException.java)** - ä¸šåŠ¡å¼‚å¸¸å®šä¹‰
3. **[`ErrorResponse.java`](backend/src/main/java/com/zl/mjga/dto/ErrorResponse.java)** - é”™è¯¯å“åº”æ ¼å¼

#### ğŸ“ å­¦ä¹ é‡ç‚¹
- [ ] **å¼‚å¸¸åˆ†å±‚** - ç³»ç»Ÿå¼‚å¸¸vsä¸šåŠ¡å¼‚å¸¸
- [ ] **ç»Ÿä¸€å“åº”æ ¼å¼** - RESTful APIè®¾è®¡
- [ ] **å›½é™…åŒ–æ”¯æŒ** - é”™è¯¯æ¶ˆæ¯çš„å¤šè¯­è¨€å¤„ç†

---

## ğŸ¤– é˜¶æ®µ3ï¼šAIç³»ç»Ÿæ·±å…¥å­¦ä¹  (4-5å¤©)

### 3.1 AIæ¶æ„è®¾è®¡ç†è§£
**ç›®æ ‡**ï¼šæ·±å…¥ç†è§£AIé›†æˆçš„æ•´ä½“æ¶æ„

#### ğŸ§  AIæ¶æ„æ ¸å¿ƒç»„ä»¶
```mermaid
graph LR
    A[ç”¨æˆ·è¯·æ±‚] --> B[AiController]
    B --> C[AiChatService]
    C --> D[ChatAssistant]
    C --> E[ToolAssistant]
    D --> F[LLMæ¨¡å‹]
    E --> G[ä¸šåŠ¡å·¥å…·]
    G --> H[æ•°æ®åº“æ“ä½œ]
```

### 3.2 AIé…ç½®ä¸åˆå§‹åŒ–
**å­¦ä¹ é¡ºåº**ï¼šé…ç½® â†’ åˆå§‹åŒ– â†’ æœåŠ¡

#### ğŸ”§ AIé…ç½®ç±»æ·±åº¦å­¦ä¹ 
1. **[`ChatModelInitializer.java`](backend/src/main/java/com/zl/mjga/config/ai/ChatModelInitializer.java)**
   ```java
   // å­¦ä¹ é‡ç‚¹ï¼š
   // 1. å¤šæ¨¡å‹é…ç½®ç®¡ç†
   // 2. Beanä¾èµ–å…³ç³»è®¾è®¡
   // 3. æµå¼å“åº”é…ç½®
   @Bean
   @DependsOn("flywayInitializer")
   public OpenAiStreamingChatModel deepSeekChatModel(DeepSeekChatModelConfig config) {
       return OpenAiStreamingChatModel.builder()
           .baseUrl(config.getBaseUrl())
           .apiKey(config.getApiKey())
           .modelName(config.getModelName())
           .build();
   }
   ```

2. **[`ToolsInitializer.java`](backend/src/main/java/com/zl/mjga/config/ai/ToolsInitializer.java)**
   ```java
   // å­¦ä¹ é‡ç‚¹ï¼š
   // 1. AIå·¥å…·æ³¨å†Œæœºåˆ¶
   // 2. å·¥å…·é“¾ç»„è£…æ¨¡å¼
   // 3. å†…å­˜ç®¡ç†é…ç½®
   @Bean
   public SystemToolAssistant zhiPuToolAssistant(ZhipuAiStreamingChatModel model) {
       return AiServices.builder(SystemToolAssistant.class)
           .streamingChatModel(model)
           .tools(userTool, departmentTool, positionTool)
           .build();
   }
   ```

3. **[`EmbeddingInitializer.java`](backend/src/main/java/com/zl/mjga/config/ai/EmbeddingInitializer.java)**
   - å‘é‡æ•°æ®åº“é…ç½®
   - åµŒå…¥æ¨¡å‹åˆå§‹åŒ–
   - RAGç³»ç»Ÿæ­å»º

#### ğŸ¯ å­¦ä¹ é‡ç‚¹
- [ ] **å¤šæ¨¡å‹ç®¡ç†** - DeepSeek vs æ™ºè°±æ¸…è¨€çš„é…ç½®å·®å¼‚
- [ ] **Beanä¾èµ–ç®¡ç†** - `@DependsOn`ç¡®ä¿åˆå§‹åŒ–é¡ºåº
- [ ] **é…ç½®æ¨¡å¼** - é…ç½®ç±»çš„è®¾è®¡æ¨¡å¼
- [ ] **èµ„æºç®¡ç†** - AIæ¨¡å‹çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†

### 3.3 AIæœåŠ¡å±‚è®¾è®¡
**æ ¸å¿ƒæ–‡ä»¶**ï¼š[`AiChatService.java`](backend/src/main/java/com/zl/mjga/service/AiChatService.java)

#### ğŸ” æœåŠ¡å±‚æ¶æ„åˆ†æ
```java
@Service
@RequiredArgsConstructor
@Slf4j
public class AiChatService {
    // å­¦ä¹ é‡ç‚¹ï¼š
    // 1. å¤šåŠ©æ‰‹ç®¡ç†ç­–ç•¥
    // 2. æ¨¡å‹é€‰æ‹©ç®—æ³•
    // 3. ä¼šè¯ç®¡ç†æœºåˆ¶
    
    private final AiChatAssistant deepSeekChatAssistant;
    private final AiChatAssistant zhiPuChatAssistant;
    private final SystemToolAssistant zhiPuToolAssistant;
    private final SystemToolAssistant deepSeekToolAssistant;
    
    public TokenStream actionPrecedenceExecuteWith(String sessionId, String message) {
        LlmCodeEnum code = getPrecedenceLlmCode();
        return switch (code) {
            case ZHI_PU -> zhiPuToolAssistant.ask(sessionId, message);
            case DEEP_SEEK -> deepSeekToolAssistant.ask(sessionId, message);
            default -> throw new BusinessException("æ— æ•ˆçš„æ¨¡å‹ä»£ç ");
        };
    }
}
```

#### ğŸ“š æ·±åº¦å­¦ä¹ è¦ç‚¹
- [ ] **ç­–ç•¥æ¨¡å¼åº”ç”¨** - å¤šæ¨¡å‹åˆ‡æ¢ç­–ç•¥
- [ ] **ä¼šè¯ç®¡ç†** - ç”¨æˆ·ä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸ
- [ ] **æµå¼å“åº”** - TokenStreamçš„å¤„ç†æœºåˆ¶
- [ ] **å¼‚å¸¸å¤„ç†** - AIè°ƒç”¨çš„é”™è¯¯å¤„ç†ç­–ç•¥

### 3.4 AIå·¥å…·ç³»ç»Ÿ
**ç›®æ ‡**ï¼šç†è§£AIå¦‚ä½•è°ƒç”¨ä¸šåŠ¡åŠŸèƒ½

#### ğŸ› ï¸ å·¥å…·ç±»æ·±åº¦åˆ†æ
1. **[`UserRolePermissionOperatorTool.java`](backend/src/main/java/com/zl/mjga/component/UserRolePermissionOperatorTool.java)**
   ```java
   @Tool(value = {"åˆ›å»ºç”¨æˆ·", "å…¥èŒç”³è¯·", "å¼€é€šè´¦å·"})
   void createUser(@P(value = "ç”¨æˆ·å") @Size(min = 1, max = 15) String name) {
       // å­¦ä¹ é‡ç‚¹ï¼š
       // 1. @Toolæ³¨è§£çš„å¤šåˆ«åæ”¯æŒ
       // 2. @På‚æ•°æ³¨è§£çš„éªŒè¯æœºåˆ¶
       // 3. ä¸šåŠ¡é€»è¾‘çš„å°è£…æ–¹å¼
       User user = userRepository.fetchOneByUsername(name);
       if (user != null) {
           throw new BusinessException("ç”¨æˆ·å·²å­˜åœ¨");
       }
       identityAccessService.upsertUser(new UserUpsertDto(null, name, name, true, null));
   }
   ```

2. **[`DepartmentOperatorTool.java`](backend/src/main/java/com/zl/mjga/component/DepartmentOperatorTool.java)**
   - éƒ¨é—¨å±‚çº§ç®¡ç†
   - å¤æ‚ä¸šåŠ¡é€»è¾‘å¤„ç†
   - æ•°æ®ä¸€è‡´æ€§ä¿è¯

3. **[`PositionOperatorTool.java`](backend/src/main/java/com/zl/mjga/component/PositionOperatorTool.java)**
   - ç®€å•CRUDæ“ä½œ
   - å·¥å…·è®¾è®¡æ¨¡å¼

#### ğŸ¯ å·¥å…·ç³»ç»Ÿå­¦ä¹ é‡ç‚¹
- [ ] **å·¥å…·æ³¨å†Œæœºåˆ¶** - `@Tool`æ³¨è§£çš„å·¥ä½œåŸç†
- [ ] **å‚æ•°éªŒè¯** - `@P`æ³¨è§£ä¸Bean Validationé›†æˆ
- [ ] **å¼‚å¸¸ä¼ æ’­** - å·¥å…·å¼‚å¸¸å¦‚ä½•ä¼ é€’ç»™AI
- [ ] **äº‹åŠ¡ç®¡ç†** - å·¥å…·è°ƒç”¨çš„äº‹åŠ¡è¾¹ç•Œ
- [ ] **æƒé™æ§åˆ¶** - å·¥å…·è°ƒç”¨çš„å®‰å…¨æœºåˆ¶

### 3.5 RAGç³»ç»Ÿå®ç°
**æ ¸å¿ƒæ–‡ä»¶**ï¼š[`RagService.java`](backend/src/main/java/com/zl/mjga/service/RagService.java)

#### ğŸ“– RAGç³»ç»Ÿæ¶æ„
```java
@Service
public class RagService {
    // å­¦ä¹ é‡ç‚¹ï¼š
    // 1. æ–‡æ¡£å¤„ç†æµæ°´çº¿
    // 2. å‘é‡åŒ–å­˜å‚¨ç­–ç•¥
    // 3. æ£€ç´¢å¢å¼ºç”Ÿæˆ
    
    @Async
    public void embeddingAndCreateDocSegment(Long libraryId, Long docId, String objectName) {
        // æ–‡æ¡£åŠ è½½ â†’ åˆ†å‰² â†’ å‘é‡åŒ– â†’ å­˜å‚¨
        Document document = amazonS3DocumentLoader.loadDocument(bucket, objectName, parser);
        DocumentByParagraphSplitter splitter = new DocumentByParagraphSplitter(500, 150);
        splitter.split(document).forEach(segment -> {
            Response<Embedding> embed = zhipuEmbeddingModel.embed(segment);
            segment.metadata().put("libraryId", libraryId);
            String embeddingId = zhiPuLibraryEmbeddingStore.add(embed.content(), segment);
            // ä¿å­˜åˆ†æ®µä¿¡æ¯
        });
    }
}
```

#### ğŸ” RAGå­¦ä¹ è¦ç‚¹
- [ ] **æ–‡æ¡£å¤„ç†æµæ°´çº¿** - åŠ è½½â†’åˆ†å‰²â†’å‘é‡åŒ–â†’å­˜å‚¨
- [ ] **å¼‚æ­¥å¤„ç†** - `@Async`çš„ä½¿ç”¨å’Œé…ç½®
- [ ] **å‘é‡å­˜å‚¨** - pgvectorçš„é›†æˆå’Œä½¿ç”¨
- [ ] **æ£€ç´¢ç­–ç•¥** - ç›¸ä¼¼åº¦æœç´¢å’Œè¿‡æ»¤
- [ ] **å…ƒæ•°æ®ç®¡ç†** - æ–‡æ¡£å…ƒä¿¡æ¯çš„å¤„ç†

---

## ğŸ’¼ é˜¶æ®µ4ï¼šä¸šåŠ¡é€»è¾‘å­¦ä¹  (3-4å¤©)

### 4.1 é¢†åŸŸé©±åŠ¨è®¾è®¡ç†è§£
**ç›®æ ‡**ï¼šç†è§£DDDåœ¨é¡¹ç›®ä¸­çš„åº”ç”¨

#### ğŸ—ï¸ é¢†åŸŸæ¨¡å‹åˆ†æ
1. **[`IdentityAccessService.java`](backend/src/main/java/com/zl/mjga/service/IdentityAccessService.java)** - èº«ä»½è®¿é—®é¢†åŸŸ
2. **[`DepartmentService.java`](backend/src/main/java/com/zl/mjga/service/DepartmentService.java)** - éƒ¨é—¨ç®¡ç†é¢†åŸŸ
3. **[`LlmService.java`](backend/src/main/java/com/zl/mjga/service/LlmService.java)** - AIæ¨¡å‹ç®¡ç†é¢†åŸŸ

#### ğŸ“‹ DDDå­¦ä¹ é‡ç‚¹
- [ ] **èšåˆæ ¹è®¾è®¡** - å®ä½“å…³ç³»çš„å»ºæ¨¡
- [ ] **é¢†åŸŸæœåŠ¡** - ä¸šåŠ¡é€»è¾‘çš„å°è£…
- [ ] **å€¼å¯¹è±¡** - DTOçš„è®¾è®¡æ¨¡å¼
- [ ] **ä»“å‚¨æ¨¡å¼** - Repositoryçš„æŠ½è±¡

### 4.2 æƒé™ç®¡ç†ç³»ç»Ÿ
**ç›®æ ‡**ï¼šç†è§£RBACæƒé™æ¨¡å‹çš„å®ç°

#### ğŸ” æƒé™ç³»ç»Ÿæ ¸å¿ƒ
```java
// å­¦ä¹ é‡ç‚¹ï¼šå¤šå¯¹å¤šå…³ç³»çš„å¤„ç†
public class IdentityAccessService {
    // ç”¨æˆ·-è§’è‰²-æƒé™çš„å¤æ‚å…³ç³»ç®¡ç†
    public void bindRoleToUser(Long userId, List<Long> roleIds) {
        // 1. æ•°æ®éªŒè¯
        // 2. å…³ç³»ç»‘å®š
        // 3. ç¼“å­˜æ›´æ–°
    }
}
```

#### ğŸ¯ æƒé™ç³»ç»Ÿå­¦ä¹ è¦ç‚¹
- [ ] **RBACæ¨¡å‹** - è§’è‰²åŸºç¡€è®¿é—®æ§åˆ¶
- [ ] **å¤šå¯¹å¤šå…³ç³»** - ç”¨æˆ·-è§’è‰²-æƒé™çš„æ˜ å°„
- [ ] **æƒé™æ£€æŸ¥** - `@PreAuthorize`çš„ä½¿ç”¨
- [ ] **æ•°æ®æƒé™** - éƒ¨é—¨æ•°æ®éš”ç¦»

### 4.3 æ§åˆ¶å™¨å±‚è®¾è®¡
**æ ¸å¿ƒæ–‡ä»¶**ï¼š[`AiController.java`](backend/src/main/java/com/zl/mjga/controller/AiController.java)

#### ğŸŒ RESTful APIè®¾è®¡
```java
@RestController
@RequestMapping("/ai")
@RequiredArgsConstructor
public class AiController {
    // å­¦ä¹ é‡ç‚¹ï¼š
    // 1. æµå¼å“åº”å¤„ç†
    // 2. å¼‚æ­¥è¯·æ±‚ç®¡ç†
    // 3. é”™è¯¯å¤„ç†æœºåˆ¶
    
    @PostMapping(value = "/action/execute", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
    public Flux<String> actionExecute(Principal principal, @RequestBody String userMessage) {
        Sinks.Many<String> sink = Sinks.many().unicast().onBackpressureBuffer();
        TokenStream chat = aiChatService.actionPrecedenceExecuteWith(principal.getName(), userMessage);
        // æµå¼å“åº”å¤„ç†
        return sink.asFlux().timeout(Duration.ofSeconds(120));
    }
}
```

#### ğŸ“¡ æ§åˆ¶å™¨å­¦ä¹ é‡ç‚¹
- [ ] **æµå¼å“åº”** - Server-Sent Eventsçš„å®ç°
- [ ] **ååº”å¼ç¼–ç¨‹** - Fluxå’ŒMonoçš„ä½¿ç”¨
- [ ] **è¶…æ—¶å¤„ç†** - é•¿æ—¶é—´è¯·æ±‚çš„ç®¡ç†
- [ ] **å®‰å…¨é›†æˆ** - Principalçš„æ³¨å…¥å’Œä½¿ç”¨

---

## ğŸ§ª é˜¶æ®µ5ï¼šæµ‹è¯•ä¸è´¨é‡ä¿è¯ (2-3å¤©)

### 5.1 æµ‹è¯•é©±åŠ¨å¼€å‘ç†è§£
**ç›®æ ‡**ï¼šå­¦ä¹ é«˜è´¨é‡çš„æµ‹è¯•ç¼–å†™

#### ğŸ”¬ æµ‹è¯•ä½“ç³»åˆ†æ
1. **å•å…ƒæµ‹è¯•** - `src/test/java/com/zl/mjga/service/`
2. **é›†æˆæµ‹è¯•** - `src/test/java/com/zl/mjga/integration/`
3. **åˆ‡ç‰‡æµ‹è¯•** - `@WebMvcTest`, `@DataJpaTest`

#### ğŸ“Š æµ‹è¯•å­¦ä¹ é‡ç‚¹
- [ ] **TestContainers** - å®¹å™¨åŒ–é›†æˆæµ‹è¯•
- [ ] **Mockç­–ç•¥** - `@MockBean`çš„ä½¿ç”¨
- [ ] **æµ‹è¯•æ•°æ®ç®¡ç†** - æµ‹è¯•æ•°æ®çš„å‡†å¤‡å’Œæ¸…ç†
- [ ] **æ–­è¨€æŠ€å·§** - AssertJçš„é«˜çº§ç”¨æ³•

### 5.2 ä»£ç è´¨é‡å·¥å…·
**ç›®æ ‡**ï¼šç†è§£ä»£ç è´¨é‡ä¿è¯æœºåˆ¶

#### ğŸ› ï¸ è´¨é‡å·¥å…·é…ç½®
1. **[`pmd-rules.xml`](backend/pmd-rules.xml)** - PMDè§„åˆ™é…ç½®
2. **[`build.gradle.kts`](backend/build.gradle.kts)** - Spotlessæ ¼å¼åŒ–é…ç½®
3. **æµ‹è¯•è¦†ç›–ç‡** - JaCoCoé…ç½®

#### ğŸ¯ è´¨é‡ä¿è¯å­¦ä¹ è¦ç‚¹
- [ ] **é™æ€ä»£ç åˆ†æ** - PMDè§„åˆ™çš„å®šåˆ¶
- [ ] **ä»£ç æ ¼å¼åŒ–** - Spotlessçš„è‡ªåŠ¨åŒ–
- [ ] **æµ‹è¯•è¦†ç›–ç‡** - è¦†ç›–ç‡è¦æ±‚å’ŒæŠ¥å‘Š
- [ ] **æŒç»­é›†æˆ** - CI/CDä¸­çš„è´¨é‡æ£€æŸ¥

---

## ğŸš€ é˜¶æ®µ6ï¼šéƒ¨ç½²ä¸è¿ç»´ (1-2å¤©)

### 6.1 äº‘åŸç”Ÿéƒ¨ç½²
**ç›®æ ‡**ï¼šç†è§£DockeråŒ–éƒ¨ç½²ç­–ç•¥

#### ğŸ³ å®¹å™¨åŒ–é…ç½®
1. **[`Dockerfile`](backend/Dockerfile)** - é•œåƒæ„å»º
2. **[`docker-compose.yml`](docker-compose.yml)** - æœåŠ¡ç¼–æ’
3. **ç¯å¢ƒé…ç½®** - `.env`æ–‡ä»¶ç®¡ç†

#### ğŸ¯ éƒ¨ç½²å­¦ä¹ é‡ç‚¹
- [ ] **å¤šé˜¶æ®µæ„å»º** - Dockeré•œåƒä¼˜åŒ–
- [ ] **æœåŠ¡å‘ç°** - å®¹å™¨é—´é€šä¿¡
- [ ] **æ•°æ®æŒä¹…åŒ–** - æ•°æ®å·ç®¡ç†
- [ ] **å¥åº·æ£€æŸ¥** - æœåŠ¡ç›‘æ§

---

## ğŸ“ˆ å­¦ä¹ è¿›åº¦è·Ÿè¸ª

### æ¯æ—¥å­¦ä¹ è®¡åˆ’
- [ ] **ç¬¬1å¤©**ï¼šé¡¹ç›®ç»“æ„ + æŠ€æœ¯æ ˆåˆ†æ
- [ ] **ç¬¬2å¤©**ï¼šSpring Booté…ç½®ä½“ç³»
- [ ] **ç¬¬3å¤©**ï¼šæ•°æ®è®¿é—®å±‚ + å¼‚å¸¸å¤„ç†
- [ ] **ç¬¬4å¤©**ï¼šAIé…ç½®ä¸åˆå§‹åŒ–
- [ ] **ç¬¬5å¤©**ï¼šAIæœåŠ¡å±‚è®¾è®¡
- [ ] **ç¬¬6å¤©**ï¼šAIå·¥å…·ç³»ç»Ÿ
- [ ] **ç¬¬7å¤©**ï¼šRAGç³»ç»Ÿå®ç°
- [ ] **ç¬¬8å¤©**ï¼šä¸šåŠ¡é€»è¾‘ + DDD
- [ ] **ç¬¬9å¤©**ï¼šæƒé™ç³»ç»Ÿ + æ§åˆ¶å™¨
- [ ] **ç¬¬10å¤©**ï¼šæµ‹è¯•ä½“ç³»
- [ ] **ç¬¬11å¤©**ï¼šä»£ç è´¨é‡
- [ ] **ç¬¬12å¤©**ï¼šéƒ¨ç½²è¿ç»´

### å­¦ä¹ æˆæœéªŒæ”¶
- [ ] èƒ½å¤Ÿç‹¬ç«‹æ­å»ºå¼€å‘ç¯å¢ƒ
- [ ] ç†è§£AIå·¥å…·çš„æ³¨å†Œå’Œè°ƒç”¨æœºåˆ¶
- [ ] æŒæ¡RAGç³»ç»Ÿçš„å®ç°åŸç†
- [ ] èƒ½å¤Ÿç¼–å†™é«˜è´¨é‡çš„å•å…ƒæµ‹è¯•
- [ ] ç†è§£é¡¹ç›®çš„éƒ¨ç½²æµç¨‹

---

## ğŸ”— æ ¸å¿ƒç±»æ–‡ä»¶å¿«é€Ÿå¯¼èˆª

### AIç³»ç»Ÿæ ¸å¿ƒç±»
- [`AiController.java`](backend/src/main/java/com/zl/mjga/controller/AiController.java) - AIæ¥å£æ§åˆ¶å™¨
- [`AiChatService.java`](backend/src/main/java/com/zl/mjga/service/AiChatService.java) - AIèŠå¤©æœåŠ¡
- [`ChatModelInitializer.java`](backend/src/main/java/com/zl/mjga/config/ai/ChatModelInitializer.java) - AIæ¨¡å‹åˆå§‹åŒ–
- [`ToolsInitializer.java`](backend/src/main/java/com/zl/mjga/config/ai/ToolsInitializer.java) - AIå·¥å…·åˆå§‹åŒ–
- [`AiChatAssistant.java`](backend/src/main/java/com/zl/mjga/config/ai/AiChatAssistant.java) - èŠå¤©åŠ©æ‰‹æ¥å£
- [`SystemToolAssistant.java`](backend/src/main/java/com/zl/mjga/config/ai/SystemToolAssistant.java) - å·¥å…·åŠ©æ‰‹æ¥å£

### AIå·¥å…·ç±»
- [`UserRolePermissionOperatorTool.java`](backend/src/main/java/com/zl/mjga/component/UserRolePermissionOperatorTool.java) - ç”¨æˆ·æƒé™å·¥å…·
- [`DepartmentOperatorTool.java`](backend/src/main/java/com/zl/mjga/component/DepartmentOperatorTool.java) - éƒ¨é—¨ç®¡ç†å·¥å…·
- [`PositionOperatorTool.java`](backend/src/main/java/com/zl/mjga/component/PositionOperatorTool.java) - å²—ä½ç®¡ç†å·¥å…·

### RAGç³»ç»Ÿ
- [`RagService.java`](backend/src/main/java/com/zl/mjga/service/RagService.java) - RAGæœåŠ¡å®ç°
- [`EmbeddingInitializer.java`](backend/src/main/java/com/zl/mjga/config/ai/EmbeddingInitializer.java) - å‘é‡æ¨¡å‹åˆå§‹åŒ–
- [`LibraryController.java`](backend/src/main/java/com/zl/mjga/controller/LibraryController.java) - çŸ¥è¯†åº“æ§åˆ¶å™¨

### ä¸šåŠ¡æ ¸å¿ƒç±»
- [`IdentityAccessService.java`](backend/src/main/java/com/zl/mjga/service/IdentityAccessService.java) - èº«ä»½è®¿é—®æœåŠ¡
- [`UserRepository.java`](backend/src/main/java/com/zl/mjga/repository/UserRepository.java) - ç”¨æˆ·æ•°æ®è®¿é—®
- [`SecurityConfig.java`](backend/src/main/java/com/zl/mjga/config/SecurityConfig.java) - å®‰å…¨é…ç½®

### é…ç½®ä¸å¼‚å¸¸
- [`GlobalExceptionHandler.java`](backend/src/main/java/com/zl/mjga/exception/GlobalExceptionHandler.java) - å…¨å±€å¼‚å¸¸å¤„ç†
- [`BusinessException.java`](backend/src/main/java/com/zl/mjga/exception/BusinessException.java) - ä¸šåŠ¡å¼‚å¸¸
- [`PromptConfiguration.java`](backend/src/main/java/com/zl/mjga/component/PromptConfiguration.java) - AIæç¤ºè¯é…ç½®

---

## ğŸ¯ è¿›é˜¶å­¦ä¹ å»ºè®®

### æ‰©å±•å­¦ä¹ æ–¹å‘
1. **AIæ¨¡å‹é›†æˆ** - å­¦ä¹ æ›´å¤šLLMæ¨¡å‹çš„æ¥å…¥
2. **æ€§èƒ½ä¼˜åŒ–** - ç¼“å­˜ç­–ç•¥å’Œæ•°æ®åº“ä¼˜åŒ–
3. **å¾®æœåŠ¡æ‹†åˆ†** - å•ä½“åˆ°å¾®æœåŠ¡çš„æ¼”è¿›
4. **ç›‘æ§å‘Šè­¦** - APMå’Œæ—¥å¿—ç³»ç»Ÿé›†æˆ

### å®è·µé¡¹ç›®å»ºè®®
1. **æ·»åŠ æ–°çš„AIå·¥å…·** - æ‰©å±•ä¸šåŠ¡æ“ä½œèƒ½åŠ›
2. **é›†æˆæ–°çš„LLMæ¨¡å‹** - å¦‚é€šä¹‰åƒé—®ã€æ–‡å¿ƒä¸€è¨€
3. **ä¼˜åŒ–RAGç³»ç»Ÿ** - æå‡æ£€ç´¢å‡†ç¡®æ€§
4. **å®Œå–„æµ‹è¯•è¦†ç›–** - æé«˜ä»£ç è´¨é‡

---

## ğŸ“š å‚è€ƒèµ„æº

- [LangChain4jå®˜æ–¹æ–‡æ¡£](https://docs.langchain4j.dev/)
- [Spring AIæ–‡æ¡£](https://docs.spring.io/spring-ai/reference/)
- [JOOQå®˜æ–¹æ–‡æ¡£](https://www.jooq.org/doc/latest/manual/)
- [TestContainersæ–‡æ¡£](https://testcontainers.com/)
- [çŸ¥è·¯é¡¹ç›®GitHub](https://github.com/ccmjga/zhilu-admin)

---

## ğŸ’¡ å­¦ä¹ æŠ€å·§

### ä»£ç é˜…è¯»ç­–ç•¥
1. **è‡ªé¡¶å‘ä¸‹** - ä»Controllerå¼€å§‹ï¼Œé€å±‚æ·±å…¥
2. **å…³æ³¨æ³¨è§£** - ç†è§£Springæ³¨è§£çš„ä½œç”¨å’Œé…ç½®
3. **è¿½è¸ªè°ƒç”¨é“¾** - ä½¿ç”¨IDEçš„"Go to Declaration"åŠŸèƒ½
4. **è¿è¡Œè°ƒè¯•** - è®¾ç½®æ–­ç‚¹ï¼Œè§‚å¯Ÿç¨‹åºæ‰§è¡Œæµç¨‹
5. **ç¼–å†™æµ‹è¯•** - é€šè¿‡æµ‹è¯•éªŒè¯ç†è§£çš„æ­£ç¡®æ€§

### å®è·µå»ºè®®
1. **æ­å»ºç¯å¢ƒ** - å…ˆè®©é¡¹ç›®åœ¨æœ¬åœ°è·‘èµ·æ¥
2. **ä¿®æ”¹ä»£ç ** - å°è¯•æ·»åŠ ç®€å•åŠŸèƒ½
3. **é˜…è¯»æ—¥å¿—** - ç†è§£ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹
4. **æŸ¥çœ‹æ•°æ®åº“** - è§‚å¯Ÿæ•°æ®ç»“æ„å’Œå˜åŒ–
5. **ä½¿ç”¨AIåŠ©æ‰‹** - ä¸ç³»ç»Ÿçš„AIåŠŸèƒ½äº¤äº’

---

**ğŸ‰ ç¥ä½ å­¦ä¹ æ„‰å¿«ï¼é€šè¿‡è¿™ä¸ªç³»ç»ŸåŒ–çš„å­¦ä¹ è·¯çº¿ï¼Œä½ å°†å…¨é¢æŒæ¡çŸ¥è·¯æ¡†æ¶çš„ç²¾é«“ï¼**
